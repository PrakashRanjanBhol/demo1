executeDelete(): void {
  if (this.selectedForDelete.size === 0 || this.isDeleting) return;

  const idsToDelete = Array.from(this.selectedForDelete);
  const numericIds = idsToDelete.map(id => Number(id));

  this.isDeleting = true;

  this.historyService.deleteFiles(numericIds).subscribe({
    next: (response) => {
      if (response.status === 'success') {
        if (this.selectedHistoryItem && idsToDelete.includes(this.selectedHistoryItem.id)) {
          this.selectedHistoryItem = null;
        }

        if (this.addedToGenerationId && idsToDelete.includes(this.addedToGenerationId)) {
          this.addedToGenerationId = null;
        }

        this.historyItems = this.historyItems.filter(item => !this.selectedForDelete.has(item.id));
        this.selectedForDelete.clear();
        this.showDeleteConfirm = false;
        this.isDeleteMode = false;
        this.isDeleting = false;
      } else {
        // Non-success status â€” remain in popup
        this.isDeleting = false;
      }
    },
    error: () => {
      this.isDeleting = false;
      // popup remains open on failure
    }
  });
}
