<!-- For Pending Files Section -->
<div class="history-item" *ngFor="let item of pendingFiles"
    [class.selected]="selectedHistoryItem?.id === item.id" (click)="onHistoryItemClick(item.id)">
    <div class="history-item-icon">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round"
                d="M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z" />
        </svg>
    </div>
    <div class="history-item-details">
        <h4 class="history-item-name">{{ item.name }}</h4>
        <p class="history-item-date">{{ item.displayDate }}</p>
    </div>
    <div class="history-item-checkmark" *ngIf="selectedHistoryItem?.id === item.id">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
        </svg>
    </div>
    <button class="add-to-generation-btn" 
            *ngIf="selectedHistoryItem?.id !== item.id"
            (click)="onAddToGeneration($event, item)"
            title="Add to content generation">
        <div class="btn-icon-wrapper">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                stroke="currentColor" class="plus-icon">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor" class="arrow-left-icon">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
            </svg>
        </div>
    </button>
</div>

<!-- For Completed Files Section -->
<div class="history-item" *ngFor="let item of completedFiles"
    [class.selected]="selectedHistoryItem?.id === item.id" (click)="onHistoryItemClick(item.id)">
    <div class="history-item-icon">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round"
                d="M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z" />
        </svg>
    </div>
    <div class="history-item-details">
        <h4 class="history-item-name">{{ item.name }}</h4>
        <p class="history-item-date">{{ item.displayDate }}</p>
    </div>
    <div class="history-item-checkmark" *ngIf="selectedHistoryItem?.id === item.id">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
        </svg>
    </div>
    <button class="add-to-generation-btn" 
            *ngIf="selectedHistoryItem?.id !== item.id"
            (click)="onAddToGeneration($event, item)"
            title="Add to content generation">
        <div class="btn-icon-wrapper">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                stroke="currentColor" class="plus-icon">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor" class="arrow-left-icon">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
            </svg>
        </div>
    </button>
</div>












/* Add to Generation Button */
.add-to-generation-btn {
    width: 36px;
    height: 36px;
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(167, 139, 250, 0.1));
    border: 1.5px solid rgba(139, 92, 246, 0.3);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    flex-shrink: 0;
    position: relative;
    overflow: hidden;
}

.add-to-generation-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary-color), #a78bfa);
    transform: translate(-50%, -50%);
    transition: width 0.4s ease, height 0.4s ease;
}

.add-to-generation-btn:hover::before {
    width: 120%;
    height: 120%;
}

.add-to-generation-btn:hover {
    border-color: var(--primary-color);
    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    transform: translateX(-2px);
}

.add-to-generation-btn:active {
    transform: translateX(-2px) scale(0.95);
}

.btn-icon-wrapper {
    position: relative;
    z-index: 1;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.plus-icon {
    width: 16px;
    height: 16px;
    stroke: var(--primary-color);
    transition: all 0.3s ease;
    position: absolute;
}

.arrow-left-icon {
    width: 18px;
    height: 18px;
    stroke: var(--primary-color);
    opacity: 0;
    transform: translateX(8px);
    transition: all 0.3s ease;
    position: absolute;
}

.add-to-generation-btn:hover .plus-icon {
    opacity: 0;
    transform: translateX(-8px);
    stroke: white;
}

.add-to-generation-btn:hover .arrow-left-icon {
    opacity: 1;
    transform: translateX(0);
    stroke: white;
}

/* Animation for successful add */
@keyframes addSuccess {
    0% {
        transform: translateX(0) scale(1);
    }
    50% {
        transform: translateX(-4px) scale(1.1);
    }
    100% {
        transform: translateX(0) scale(1);
    }
}

.add-to-generation-btn.added {
    animation: addSuccess 0.5s ease;
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(74, 222, 128, 0.1));
    border-color: rgba(34, 197, 94, 0.5);
}

.add-to-generation-btn.added .plus-icon {
    stroke: #22c55e;
}

/* Responsive adjustments */
@media screen and (max-width: 1400px) {
    .add-to-generation-btn {
        width: 32px;
        height: 32px;
        border-radius: 8px;
    }

    .btn-icon-wrapper {
        width: 18px;
        height: 18px;
    }

    .plus-icon {
        width: 14px;
        height: 14px;
    }

    .arrow-left-icon {
        width: 16px;
        height: 16px;
    }
}













import { Component, EventEmitter, Output, OnInit } from '@angular/core';
import { HistoryService, FileItem } from './history.service';

interface HistoryItem {
  id: string;
  name: string;
  displayDate: string;
  date: Date;
  hasResult: boolean;
}

@Component({
  selector: 'app-history',
  templateUrl: './history.component.html',
  styleUrls: ['./history.component.css']
})
export class HistoryComponent implements OnInit {
  @Output() onItemSelect = new EventEmitter<string>();
  @Output() onAddToContentGeneration = new EventEmitter<HistoryItem>(); // New output event

  selectedHistoryItem: HistoryItem | null = null;
  isPendingExpanded: boolean = true;
  isCompletedExpanded: boolean = true;

  startDate: string = '';
  endDate: string = '';

  historyItems: HistoryItem[] = [];
  isLoading: boolean = false;
  errorMessage: string = '';

  constructor(private historyService: HistoryService) {}

  ngOnInit(): void {
    this.initializeDateRange();
    this.fetchHistoryData();
  }

  get pendingFiles(): HistoryItem[] {
    return this.historyItems.filter(item => !item.hasResult);
  }

  get completedFiles(): HistoryItem[] {
    return this.historyItems.filter(item => item.hasResult);
  }

  onHistoryItemClick(itemId: string): void {
    const item = this.historyItems.find(i => i.id === itemId);
    if (item) {
      this.selectedHistoryItem = item;
      this.onItemSelect.emit(itemId);
    }
  }

  onAddToGeneration(event: Event, item: HistoryItem): void {
    event.stopPropagation(); // Prevent triggering the item selection
    
    // Emit the item to parent component for content generation
    this.onAddToContentGeneration.emit(item);
    
    // Visual feedback - add 'added' class temporarily
    const button = (event.currentTarget as HTMLElement);
    button.classList.add('added');
    
    setTimeout(() => {
      button.classList.remove('added');
    }, 500);
    
    console.log('Adding to content generation:', item.name);
  }

  togglePendingSection(): void {
    this.isPendingExpanded = !this.isPendingExpanded;
  }

  toggleCompletedSection(): void {
    this.isCompletedExpanded = !this.isCompletedExpanded;
  }

  clearSelection(): void {
    this.selectedHistoryItem = null;
  }

  addHistoryItem(item: HistoryItem): void {
    this.historyItems.unshift(item);
  }

  private initializeDateRange(): void {
    const today = new Date();
    const thirtyDaysAgo = new Date();
    thirtyDaysAgo.setDate(today.getDate() - 30);

    this.startDate = this.formatDateForDisplay(thirtyDaysAgo);
    this.endDate = this.formatDateForDisplay(today);
  }

  private fetchHistoryData(): void {
    this.isLoading = true;
    this.errorMessage = '';

    const today = new Date();
    const thirtyDaysAgo = new Date();
    thirtyDaysAgo.setDate(today.getDate() - 30);

    const startDateForApi = this.formatDateForApi(thirtyDaysAgo);
    const endDateForApi = this.formatDateForApi(today);

    this.historyService.getFilesByDateRange(startDateForApi, endDateForApi)
      .subscribe({
        next: (response) => {
          if (response.status === 'success' && response.data.files) {
            this.historyItems = this.mapFilesToHistoryItems(response.data.files);
          }
          this.isLoading = false;
        },
        error: (error) => {
          console.error('Error fetching history data:', error);
          this.errorMessage = 'Failed to load history data. Please try again.';
          this.isLoading = false;
        }
      });
  }

  private mapFilesToHistoryItems(files: FileItem[]): HistoryItem[] {
    return files.map(file => {
      const hasResult = file.progress === 'completed';

      return {
        id: file.id.toString(),
        name: file.original_name,
        displayDate: `Created on ${file.inserted_at}`,
        date: this.parseInsertedDate(file.inserted_at),
        hasResult: hasResult
      };
    });
  }

  private parseInsertedDate(dateString: string): Date {
    return new Date(dateString);
  }

  private formatDateForDisplay(date: Date): string {
    const options: Intl.DateTimeFormatOptions = { 
      month: 'short', 
      day: 'numeric', 
      year: 'numeric' 
    };
    return date.toLocaleDateString('en-US', options);
  }

  private formatDateForApi(date: Date): string {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
  }
}



<app-history 
  (onItemSelect)="handleItemSelect($event)"
  (onAddToContentGeneration)="handleAddToGeneration($event)">
</app-history>


handleAddToGeneration(item: HistoryItem): void {
  // Add the item to your left-side content generation component
  console.log('File added to content generation:', item);
  // Your logic here to add to the generation queue
}
