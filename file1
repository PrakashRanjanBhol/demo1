import { Component, OnInit } from '@angular/core';
import { trigger, state, style, transition, animate } from '@angular/animations';

interface ChatSession {
  session_id: string;
  created_date: string;
  count: number;
  first_prompt: string;
  ps_session_id: number;
  is_new: boolean;
}

@Component({
  selector: 'app-chat-sidebar',
  templateUrl: './chat-sidebar.component.html',
  styleUrls: ['./chat-sidebar.component.css'],
  animations: [
    trigger('slideDown', [
      state('closed', style({
        height: '0',
        opacity: '0',
        marginTop: '0',
        overflow: 'hidden'
      })),
      state('open', style({
        height: '*',
        opacity: '1',
        marginTop: '8px',
        overflow: 'hidden'
      })),
      transition('closed => open', [
        animate('250ms ease-out')
      ]),
      transition('open => closed', [
        animate('200ms ease-in')
      ])
    ])
  ]
})
export class ChatSidebarComponent implements OnInit {
  sessions: ChatSession[] = [];
  sessionId: string | null = null; // This is your variable that determines which card to highlight
  openMenuId: string | null = null; // Tracks which menu is open

  ngOnInit(): void {
    this.loadChatHistory();
  }

  loadChatHistory(): void {
    // Replace this with your actual API call
    // Example: this.http.get<ChatSession[]>('your-api-endpoint').subscribe(data => {
    //   this.sessions = data;
    //   // Set sessionId based on your logic (e.g., from route params, service, etc.)
    //   // this.sessionId = 'some-session-id';
    // });

    // Mock data for demonstration
    this.sessions = [
      {
        session_id: 'abcdefgh',
        created_date: '2024-12-17 14:34:00',
        count: 3,
        first_prompt: 'I have a sidebar of width 320px in screen width less than 1600px and 380px width for screen width more than 1600px',
        ps_session_id: 1,
        is_new: false
      },
      {
        session_id: 'ijklmnop',
        created_date: '2024-12-17 11:23:00',
        count: 8,
        first_prompt: 'Can you help me refactor this React component to use hooks instead of class components?',
        ps_session_id: 2,
        is_new: true
      },
      {
        session_id: 'qrstuvwx',
        created_date: '2024-12-17 09:45:00',
        count: 12,
        first_prompt: "I'm working on a sci-fi short story about AI and consciousness. Could you help brainstorm some interesting plot points?",
        ps_session_id: 3,
        is_new: false
      },
      {
        session_id: 'yzabcdef',
        created_date: '2024-12-16 18:12:00',
        count: 5,
        first_prompt: 'Help me analyze this dataset using pandas and create visualizations with matplotlib',
        ps_session_id: 4,
        is_new: false
      },
      {
        session_id: 'ghijklmn',
        created_date: '2024-12-16 15:28:00',
        count: 7,
        first_prompt: 'Looking for thought-provoking non-fiction books about technology and society',
        ps_session_id: 5,
        is_new: false
      },
      {
        session_id: 'opqrstuv',
        created_date: '2024-12-16 10:15:00',
        count: 4,
        first_prompt: 'Need help creating a professional email template for client outreach campaigns',
        ps_session_id: 6,
        is_new: false
      },
      {
        session_id: 'wxyzabcd',
        created_date: '2024-12-14 16:30:00',
        count: 15,
        first_prompt: 'Discussing best practices for creating intuitive user interfaces and user experiences',
        ps_session_id: 7,
        is_new: false
      },
      {
        session_id: 'efghijkl',
        created_date: '2024-12-13 14:20:00',
        count: 6,
        first_prompt: 'Strategies for improving REST API response times and reducing server load',
        ps_session_id: 8,
        is_new: false
      }
    ];

    // Example: Set sessionId to the first item for demo
    // In your real app, this would come from route params, service, or other source
    if (this.sessions.length > 0) {
      this.sessionId = this.sessions[0].session_id;
    }
  }

  formatDate(dateString: string): string {
    const date = new Date(dateString);
    const now = new Date();
    const yesterday = new Date(now);
    yesterday.setDate(yesterday.getDate() - 1);

    // Check if it's today
    if (date.toDateString() === now.toDateString()) {
      return date.toLocaleTimeString('en-US', {
        hour: 'numeric',
        minute: '2-digit',
        hour12: true
      });
    }

    // Check if it's yesterday
    if (date.toDateString() === yesterday.toDateString()) {
      return `Yesterday, ${date.toLocaleTimeString('en-US', {
        hour: 'numeric',
        minute: '2-digit',
        hour12: true
      })}`;
    }

    // For older dates
    return date.toLocaleDateString('en-US', {
      month: 'short',
      day: 'numeric'
    });
  }

  truncate(text: string, maxLength: number): string {
    if (text.length <= maxLength) return text;
    return text.substring(0, maxLength) + '...';
  }

  createTitle(text: string): string {
    return this.truncate(text, 50);
  }

  onCardClick(session_id: string): void {
    this.sessionId = session_id;
    console.log('Selected session:', session_id);
    // Add your navigation logic here
    // Example: this.router.navigate(['/chat', session_id]);
  }

  toggleChatActionMenu(event: Event, session_id: string): void {
    event.stopPropagation();
    this.openMenuId = this.openMenuId === session_id ? null : session_id;
  }

  isMenuOpen(session_id: string): boolean {
    return this.openMenuId === session_id;
  }

  onEdit(event: Event, session_id: string): void {
    event.stopPropagation();
    console.log('Edit session:', session_id);
    this.openMenuId = null; // Close menu after action
    // Add your edit logic here
  }

  onShare(event: Event, session_id: string): void {
    event.stopPropagation();
    console.log('Share session:', session_id);
    this.openMenuId = null; // Close menu after action
    // Add your share logic here
  }

  onDelete(event: Event, session_id: string): void {
    event.stopPropagation();
    console.log('Delete session:', session_id);
    this.openMenuId = null; // Close menu after action
    // Add your delete logic here
  }

  isActive(session_id: string): boolean {
    return this.sessionId === session_id;
  }
}

















/* CSS Variables for Light Mode (Default) */
:root {
  /* Background Colors */
  --playground-card-bg-primary: #ffffff;
  --playground-card-bg-secondary: #f5f5f7;
  --playground-card-bg-active: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
  --playground-card-bg-hover: #f5f5f7;
  
  /* Border Colors */
  --playground-card-border-primary: #e5e5e7;
  --playground-card-border-secondary: #f0f0f2;
  --playground-card-border-hover: #c7c7cc;
  --playground-card-border-active: #667eea;
  
  /* Text Colors */
  --playground-card-text-primary: #1d1d1f;
  --playground-card-text-secondary: #86868b;
  --playground-card-text-tertiary: #86868b;
  
  /* Action Button Colors */
  --playground-card-action-bg: #f5f5f7;
  --playground-card-action-bg-hover: #e8e8ed;
  --playground-card-action-border: #e5e5e7;
  --playground-card-action-border-hover: #d1d1d6;
  --playground-card-action-text: #1d1d1f;
  
  /* Action Button Edit Colors */
  --playground-card-action-edit-bg-hover: #e3f2fd;
  --playground-card-action-edit-border-hover: #2196f3;
  --playground-card-action-edit-text-hover: #1976d2;
  
  /* Action Button Share Colors */
  --playground-card-action-share-bg-hover: #e8f5e9;
  --playground-card-action-share-border-hover: #4caf50;
  --playground-card-action-share-text-hover: #2e7d32;
  
  /* Action Button Delete Colors */
  --playground-card-action-delete-bg-hover: #ffebee;
  --playground-card-action-delete-border-hover: #f44336;
  --playground-card-action-delete-text-hover: #c62828;
  
  /* Badge Colors */
  --playground-card-badge-bg: #667eea;
  --playground-card-badge-text: #ffffff;
  
  /* Scrollbar Colors */
  --playground-card-scrollbar-thumb: #d1d1d6;
  --playground-card-scrollbar-thumb-hover: #a1a1a6;
  
  /* Accent Colors */
  --playground-card-accent-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  
  /* Shadow */
  --playground-card-shadow-hover: 0 2px 8px rgba(0, 0, 0, 0.06);
}

/* CSS Variables for Dark Mode */
[data-theme='dark'] {
  /* Background Colors */
  --playground-card-bg-primary: #1a1a1d;
  --playground-card-bg-secondary: #111113;
  --playground-card-bg-active: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
  --playground-card-bg-hover: #27272a;
  
  /* Border Colors */
  --playground-card-border-primary: #27272a;
  --playground-card-border-secondary: #27272a;
  --playground-card-border-hover: #3f3f46;
  --playground-card-border-active: #667eea;
  
  /* Text Colors */
  --playground-card-text-primary: #fafafa;
  --playground-card-text-secondary: #a1a1aa;
  --playground-card-text-tertiary: #71717a;
  
  /* Action Button Colors */
  --playground-card-action-bg: #27272a;
  --playground-card-action-bg-hover: #3f3f46;
  --playground-card-action-border: #3f3f46;
  --playground-card-action-border-hover: #52525b;
  --playground-card-action-text: #fafafa;
  
  /* Action Button Edit Colors */
  --playground-card-action-edit-bg-hover: rgba(33, 150, 243, 0.15);
  --playground-card-action-edit-border-hover: #2196f3;
  --playground-card-action-edit-text-hover: #64b5f6;
  
  /* Action Button Share Colors */
  --playground-card-action-share-bg-hover: rgba(76, 175, 80, 0.15);
  --playground-card-action-share-border-hover: #4caf50;
  --playground-card-action-share-text-hover: #81c784;
  
  /* Action Button Delete Colors */
  --playground-card-action-delete-bg-hover: rgba(244, 67, 54, 0.15);
  --playground-card-action-delete-border-hover: #f44336;
  --playground-card-action-delete-text-hover: #e57373;
  
  /* Badge Colors */
  --playground-card-badge-bg: #667eea;
  --playground-card-badge-text: #ffffff;
  
  /* Scrollbar Colors */
  --playground-card-scrollbar-thumb: #3f3f46;
  --playground-card-scrollbar-thumb-hover: #52525b;
  
  /* Accent Colors */
  --playground-card-accent-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  
  /* Shadow */
  --playground-card-shadow-hover: 0 2px 8px rgba(0, 0, 0, 0.3);
}

/* Component Styles */
.sidebar {
  width: 320px;
  background: var(--playground-card-bg-primary);
  border-right: 1px solid var(--playground-card-border-primary);
  display: flex;
  flex-direction: column;
  transition: width 0.3s ease;
  height: 100vh;
}

@media (min-width: 1600px) {
  .sidebar {
    width: 380px;
  }
}

.sidebar-header {
  padding: 24px 20px 16px;
  border-bottom: 1px solid var(--playground-card-border-secondary);
}

.sidebar-title {
  font-size: 20px;
  font-weight: 600;
  color: var(--playground-card-text-primary);
  margin-bottom: 8px;
}

.sidebar-subtitle {
  font-size: 13px;
  color: var(--playground-card-text-secondary);
}

.chat-list {
  flex: 1;
  overflow-y: auto;
  padding: 16px 12px;
}

.chat-list::-webkit-scrollbar {
  width: 6px;
}

.chat-list::-webkit-scrollbar-track {
  background: transparent;
}

.chat-list::-webkit-scrollbar-thumb {
  background: var(--playground-card-scrollbar-thumb);
  border-radius: 3px;
}

.chat-list::-webkit-scrollbar-thumb:hover {
  background: var(--playground-card-scrollbar-thumb-hover);
}

.chat-card {
  background: var(--playground-card-bg-primary);
  border: 1px solid var(--playground-card-border-primary);
  border-radius: 12px;
  padding: 12px 16px;
  margin-bottom: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
  overflow: hidden;
}

.chat-card::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background: var(--playground-card-accent-gradient);
  transform: scaleY(0);
  transition: transform 0.2s ease;
}

.chat-card:hover {
  border-color: var(--playground-card-border-hover);
  box-shadow: var(--playground-card-shadow-hover);
  transform: translateX(2px);
}

.chat-card:hover::before {
  transform: scaleY(1);
}

.chat-card.active {
  background: var(--playground-card-bg-active);
  border-color: var(--playground-card-border-active);
}

.chat-card.active::before {
  transform: scaleY(1);
}

.chat-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 8px;
}

.chat-info {
  flex: 1;
  min-width: 0;
}

.chat-meta {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
}

.chat-time {
  font-size: 11px;
  color: var(--playground-card-text-tertiary);
  white-space: nowrap;
}

.chat-title {
  font-size: 14px;
  font-weight: 500;
  color: var(--playground-card-text-primary);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.menu-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  background: transparent;
  border: 1px solid transparent;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
  flex-shrink: 0;
  padding: 0;
  color: var(--playground-card-text-secondary);
}

.menu-btn:hover {
  background: var(--playground-card-action-bg);
  border-color: var(--playground-card-action-border);
  color: var(--playground-card-text-primary);
}

.menu-btn svg {
  width: 18px;
  height: 18px;
}

.chat-actions {
  display: flex;
  gap: 4px;
  overflow: hidden;
}

.chat-actions.show {
  margin-top: 8px;
  opacity: 1;
}

.action-btn {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 6px 10px;
  background: var(--playground-card-action-bg);
  border: 1px solid var(--playground-card-action-border);
  border-radius: 6px;
  font-size: 12px;
  color: var(--playground-card-action-text);
  cursor: pointer;
  transition: all 0.2s ease;
  white-space: nowrap;
  outline: none;
}

.action-btn:hover {
  background: var(--playground-card-action-bg-hover);
  border-color: var(--playground-card-action-border-hover);
}

.action-btn svg {
  width: 14px;
  height: 14px;
  flex-shrink: 0;
}

.action-btn.edit:hover {
  background: var(--playground-card-action-edit-bg-hover);
  border-color: var(--playground-card-action-edit-border-hover);
  color: var(--playground-card-action-edit-text-hover);
}

.action-btn.share:hover {
  background: var(--playground-card-action-share-bg-hover);
  border-color: var(--playground-card-action-share-border-hover);
  color: var(--playground-card-action-share-text-hover);
}

.action-btn.delete:hover {
  background: var(--playground-card-action-delete-bg-hover);
  border-color: var(--playground-card-action-delete-border-hover);
  color: var(--playground-card-action-delete-text-hover);
}

@media (min-width: 1600px) {
  .chat-card {
    padding: 14px 18px;
  }

  .chat-title {
    font-size: 15px;
  }
}














<div class="sidebar">
  <div class="sidebar-header">
    <div class="sidebar-title">Chat History</div>
    <div class="sidebar-subtitle">Your recent conversations</div>
  </div>

  <div class="chat-list">
    <div
      *ngFor="let chat of sessions"
      class="chat-card"
      [class.active]="isActive(chat.session_id)"
      (click)="onCardClick(chat.session_id)"
    >
      <div class="chat-header">
        <div class="chat-info">
          <div class="chat-meta">
            <span class="chat-time">{{ formatDate(chat.created_date) }}</span>
          </div>
          <div class="chat-title">{{ createTitle(chat.first_prompt) }}</div>
        </div>
        <button class="menu-btn" (click)="toggleChatActionMenu($event, chat.session_id)">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
          </svg>
        </button>
      </div>
      <div class="chat-actions" [@slideDown]="isMenuOpen(chat.session_id) ? 'open' : 'closed'">
        <button class="action-btn edit" (click)="onEdit($event, chat.session_id)">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
            />
          </svg>
          Edit
        </button>
        <button class="action-btn share" (click)="onShare($event, chat.session_id)">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"
            />
          </svg>
          Share
        </button>
        <button class="action-btn delete" (click)="onDelete($event, chat.session_id)">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
            />
          </svg>
          Delete
        </button>
      </div>
    </div>
  </div>
</div>
