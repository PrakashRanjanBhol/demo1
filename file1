interface FileInfo {
  id: number;
  name: string;
  path: string;
  size: string;
  repository: string;
  content: string;
  type: string;
  renderedContent?: SafeHtml; // Add this
  currentLoadedLines?: number; // Add this
  totalLines?: number; // Add this
}





private renderFileContent(file: FileInfo): void {
  if (!file) return;

  const fileType = file.type || 'plaintext';
  const lines = file.content.split('\n');
  file.totalLines = lines.length;
  
  // Initialize currentLoadedLines if not set
  if (!file.currentLoadedLines) {
    file.currentLoadedLines = this.LINES_PER_LOAD;
  }

  // Get the content to display (limited lines)
  const contentToDisplay = lines.slice(0, file.currentLoadedLines).join('\n');

  let renderedContent: SafeHtml;
  
  if (fileType === 'markdown') {
    this.showViewToggle = true;
    if (this.currentView === 'preview') {
      renderedContent = this.sanitizer.bypassSecurityTrustHtml(
        this.renderMarkdownView(contentToDisplay)
      );
    } else {
      renderedContent = this.sanitizer.bypassSecurityTrustHtml(
        this.renderCodeView(contentToDisplay, 'markdown')
      );
    }
  } else {
    this.showViewToggle = false;
    this.currentView = 'code';
    renderedContent = this.sanitizer.bypassSecurityTrustHtml(
      this.renderCodeView(contentToDisplay, fileType)
    );
  }

  // Update the file object with rendered content
  file.renderedContent = renderedContent;
}







// Method to switch to File view
selectFile(file: FileInfo): void {
  this.selectedFile = file;
  this.activeView = 'file';
  
  // Reset or initialize loading state
  if (!file.currentLoadedLines) {
    file.currentLoadedLines = this.LINES_PER_LOAD;
  }
  
  this.renderFileContent(file);
}





// Load more lines
loadMoreLines(): void {
  if (!this.selectedFile || this.isLoading) return;
  
  this.isLoading = true;
  
  // Simulate async loading (remove setTimeout for real implementation)
  setTimeout(() => {
    if (this.selectedFile) {
      this.selectedFile.currentLoadedLines = 
        (this.selectedFile.currentLoadedLines || this.LINES_PER_LOAD) + this.LINES_PER_LOAD;
      this.renderFileContent(this.selectedFile);
    }
    this.isLoading = false;
  }, 100);
}








// Get lines info text
getLinesInfo(): string {
  if (!this.selectedFile || !this.selectedFile.totalLines) return '';
  const loaded = Math.min(
    this.selectedFile.currentLoadedLines || this.LINES_PER_LOAD, 
    this.selectedFile.totalLines
  );
  return `Showing ${loaded} of ${this.selectedFile.totalLines} lines`;
}

// Check if there are more lines
get hasMoreLines(): boolean {
  if (!this.selectedFile || !this.selectedFile.totalLines) return false;
  return this.selectedFile.totalLines > (this.selectedFile.currentLoadedLines || this.LINES_PER_LOAD);
}








// File viewer methods
changeView(view: string): void {
  this.currentView = view;
  if (this.selectedFile) {
    this.renderFileContent(this.selectedFile);
  }
}











<!-- File Content with Code Viewer -->
<div class="content-view file-viewer-content" [class.active]="activeView === 'file' && selectedFile" *ngIf="selectedFile">
  <div class="file-content-wrapper">
    <div [innerHTML]="selectedFile.renderedContent"></div>
    
    <!-- Load More Section -->
    <div class="load-more-section" *ngIf="hasMoreLines">
      <div class="lines-info">{{ getLinesInfo() }}</div>
      <button class="load-more-btn" (click)="loadMoreLines()" [disabled]="isLoading">
        <svg *ngIf="!isLoading" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="6 9 12 15 18 9"/>
        </svg>
        <svg *ngIf="isLoading" class="spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
        </svg>
        <span>{{ isLoading ? 'Loading...' : 'Load More Lines' }}</span>
      </button>
    </div>
  </div>
</div>














