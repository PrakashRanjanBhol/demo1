// Update this method to include filename
private onProgressComplete(): void {
  this.stopPolling();
  
  const fileName = this.uploadMode === 'new' 
    ? this.selectedUploadFile?.name 
    : this.selectedPreviousFile?.name;
  
  this.onGenerate.emit({
    file: {
      fileID: this.uploadMode === 'new' 
        ? this.uploadedFilesWithStatus.find(f => f.file.name === this.selectedUploadFile?.name)?.uploadedFileId 
        : this.selectedPreviousFile?.id,
      fileName: fileName, // Add this line
      optional_prompt: this.optionalPrompts,
      model_name: this.selectedModel
    },
    prompts: this.optionalPrompts,
    mode: this.uploadMode
  });

  setTimeout(() => {
    this.completeProcessing();
  }, 500);
}









onGenerateComplete(data: { file: any, prompts: string, mode: string }): void {
  const newItem = {
    id: data.file.fileID.toString(), // Changed to use fileID
    name: data.file.fileName, // Changed to use fileName
    displayDate: 'Created on ' + new Date().toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    }),
    date: new Date(),
    progress: 'in progress', // Set initial progress as 'in progress'
    status: 'in-progress' as 'not-generated' | 'in-progress' | 'completed',
    isClickable: false
  };

  // Add to history
  if (this.historyComponent) {
    this.historyComponent.addHistoryItem(newItem);
  }

  // Optionally, you can simulate progress completion
  // Remove this if progress is updated from backend
  setTimeout(() => {
    // Update the item to completed status
    const itemToUpdate = this.historyComponent?.historyItems.find((i: any) => i.id === newItem.id);
    if (itemToUpdate) {
      itemToUpdate.progress = 'completed';
      itemToUpdate.status = 'completed';
      itemToUpdate.isClickable = true;
      this.historyComponent.filteredHistory = [...this.historyComponent.historyItems];
    }

    // Load results
    this.selectedHistoryItem = itemToUpdate || newItem;
    this.loadResultsForItem(newItem.id);
  }, 3000); // Simulate 3 second processing time
}
