package org.example;

import java.awt.Desktop;
import java.io.IOException;
import java.net.URI;
import java.net.URISyntaxException;

/**
 * Web Application Launcher
 * Opens the specified URL in the system's default browser
 * Can be packaged as an executable with custom icon
 */
public class WebAppLauncher {

    // CHANGE THIS TO YOUR WEBSITE URL
    private static final String WEBSITE_URL = "http://localhost:4200/";

    public static void main(String[] args) {
        try {
            // Check if Desktop is supported
            if (!Desktop.isDesktopSupported()) {
                System.err.println("Desktop is not supported on this system");
                showErrorAndExit("Desktop operations are not supported on this system.");
                return;
            }

            Desktop desktop = Desktop.getDesktop();

            // Check if browse operation is supported
            if (!desktop.isSupported(Desktop.Action.BROWSE)) {
                System.err.println("Browse action is not supported");
                showErrorAndExit("Browser launch is not supported on this system.");
                return;
            }

            // Open the URL in default browser
            System.out.println("Opening: " + WEBSITE_URL);
            desktop.browse(new URI(WEBSITE_URL));

            // Small delay to ensure browser starts
            Thread.sleep(500);

            // Exit successfully
            System.exit(0);

        } catch (URISyntaxException e) {
            System.err.println("Invalid URL: " + e.getMessage());
            showErrorAndExit("Invalid URL configured: " + WEBSITE_URL);

        } catch (IOException e) {
            System.err.println("Failed to open browser: " + e.getMessage());
            showErrorAndExit("Failed to open browser. Please check your system settings.");

        } catch (InterruptedException e) {
            System.err.println("Interrupted: " + e.getMessage());
            Thread.currentThread().interrupt();
            System.exit(1);

        } catch (Exception e) {
            System.err.println("Unexpected error: " + e.getMessage());
            e.printStackTrace();
            showErrorAndExit("An unexpected error occurred: " + e.getMessage());
        }
    }

    /**
     * Shows error message and exits
     */
    private static void showErrorAndExit(String message) {
        // Try to show GUI error dialog if available
        try {
            javax.swing.JOptionPane.showMessageDialog(
                    null,
                    message,
                    "Error - Web App Launcher",
                    javax.swing.JOptionPane.ERROR_MESSAGE
            );
        } catch (Exception e) {
            // If GUI fails, just print to console
            System.err.println("ERROR: " + message);
        }
        System.exit(1);
    }
}















// Gradle Build Configuration for Web App Launcher (Kotlin DSL)
// This is for build.gradle.kts file

plugins {
    java
    application
}

group = "org.example"
version = "1.0.0"

// Java version configuration
java {
    sourceCompatibility = JavaVersion.VERSION_1_8
    targetCompatibility = JavaVersion.VERSION_1_8
}

// Set the main class for the application
application {
    mainClass.set("org.example.WebAppLauncher")  // Works in .kts
}

repositories {
    mavenCentral()
}

dependencies {
    // No external dependencies needed for this application
    // Add dependencies here if needed in the future
}

// Configure JAR task to create executable JAR
tasks.jar {
    manifest {
        attributes(
            "Main-Class" to "org.example.WebAppLauncher",
            "Implementation-Title" to "Web App Launcher",
            "Implementation-Version" to version
        )
    }

    // Create a fat JAR with all dependencies (if any are added later)
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
    from(configurations.runtimeClasspath.get().map {
        if (it.isDirectory) it else zipTree(it)
    })
}

// Custom task to copy the JAR to a convenient location with a simple name
tasks.register<Copy>("copyJar") {
    dependsOn(tasks.jar)
    from(tasks.jar.get().archiveFile)
    into("$buildDir/dist")
    rename { "WebAppLauncher.jar" }
    doLast {
        println("")
        println("================================================")
        println("BUILD SUCCESSFUL!")
        println("================================================")
        println("Your executable JAR is ready:")
        println("  â†’ $buildDir/dist/WebAppLauncher.jar")
        println("")
        println("Test it with:")
        println("  java -jar build/dist/WebAppLauncher.jar")
        println("================================================")
    }
}

// Make build task depend on copyJar so it runs automatically
tasks.build {
    dependsOn("copyJar")
}

// Optional: Task to run the application directly
tasks.register<JavaExec>("runApp") {
    group = "application"
    description = "Runs the Web App Launcher"
    classpath = sourceSets.main.get().runtimeClasspath
    mainClass.set("org.example.WebAppLauncher")
}

// Optional: Clean task enhancement
tasks.clean {
    delete("$buildDir/dist")
}
