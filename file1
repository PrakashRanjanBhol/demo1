import { Component, OnInit, ChangeDetectorRef, ViewChild, ElementRef } from '@angular/core';

export class ChunkedJsonParserComponent implements OnInit {
  // ... existing properties ...
  
  @ViewChild('executedFileList', { read: ElementRef }) executedFileListRef!: ElementRef; // ADD THIS

  // ... existing methods ...

  // MODIFIED setupCallbacks - add scroll after rendering
  private setupCallbacks(): void {
    this.parserService.setCallbacks({
      onToolDetected: (toolData: ToolData) => {
        this.logToolDetected(toolData);
        this.updateLists();
        
        if (toolData.tool === 'READ') {
          this.appendReadContent(toolData);
          this.scrollToBottom(); // ADD THIS
        } else {
          // For WRITE/MODIFY, scroll after Angular renders
          this.cdr.detectChanges();
          this.scrollToBottom(); // ADD THIS
        }
      },
      onApprovalRequest: (approvalRequest: ApprovalRequest) => {
        this.isWaitingForApproval = true;
        this.currentApprovalRequest = approvalRequest;
        this.isApprovingChanges = false;
        this.logWaitingForApproval(approvalRequest.data);
        this.updateLists();
        this.cdr.detectChanges();
        this.scrollToBottom(); // ADD THIS
      },
      onCompletion: () => {
        this.isProcessing = false;
        this.isApprovingChanges = false;
        this.hasReceivedFirstChunk = false;
        this.isCompleted = true;
        this.logCompleted();
        this.updateLists();
        this.cdr.detectChanges();
      },
      onError: (error: string) => {
        this.isProcessing = false;
        this.isApprovingChanges = false;
        this.hasReceivedFirstChunk = false;
        this.logError(error);
      },
      onFirstChunk: () => {
        this.hasReceivedFirstChunk = true;
        this.logFirstChunkReceived();
        this.cdr.detectChanges();
      }
    });
  }

  // ADD this new method
  private scrollToBottom(): void {
    setTimeout(() => {
      if (this.executedFileListRef && this.executedFileListRef.nativeElement) {
        const element = this.executedFileListRef.nativeElement;
        element.scrollTop = element.scrollHeight;
      }
    }, 100);
  }

  // ... rest of existing methods ...
}










<!-- Executed Files Section -->
<div class="vibe-coding-section vibe-coding-executed">
  <div class="vibe-coding-section-header">
    <div class="vibe-coding-section-icon">âœ“</div>
    <div class="vibe-coding-section-title">
      <h2>Executed</h2>
      <div class="vibe-coding-count"><span>{{ executedItems.length }}</span> completed</div>
    </div>
  </div>
  <div class="vibe-coding-file-list" #executedFileList> <!-- ADD #executedFileList -->
    <!-- ... rest of the content ... -->
  </div>
</div>
