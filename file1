.wrapper {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  border-radius: 12px;
  border: 1px solid var(--border-subtle);
  box-shadow: var(--shadow-sm);
  background: var(--bg-surface);
}

.toolbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 20px;
  border-bottom: 1px solid var(--border-subtle);
  flex-shrink: 0;
}

.tableScroll {
  flex: 1;
  overflow: hidden;
}

table {
  width: 100%;
  border-collapse: collapse;
}

thead {
  background: var(--bg-sidebar);

  th {
    padding: 11px 20px;
    border-bottom: 1px solid var(--border-subtle);
  }
}

tbody {
  tr {
    border-bottom: 1px solid var(--border-subtle);

    &:last-child {
      border-bottom: none;
    }
  }

  td {
    padding: 14px 20px;
  }
}

.footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 20px;
  border-top: 1px solid var(--border-subtle);
  background: var(--bg-sidebar);
  flex-shrink: 0;
}

// Skeleton shimmer base
.skeletonBase {
  border-radius: 6px;
  background: linear-gradient(
    90deg,
    var(--bg-hover) 25%,
    var(--border-subtle) 50%,
    var(--bg-hover) 75%
  );
  background-size: 200% 100%;
  animation: shimmer 1.4s ease-in-out infinite;
}

@keyframes shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

.skeletonSearch {
  composes: skeletonBase;
  height: 36px;
  width: 260px;
  border-radius: 8px;
}

.skeletonCount {
  composes: skeletonBase;
  height: 28px;
  width: 80px;
  border-radius: 6px;
}

.skeletonHeader {
  composes: skeletonBase;
  height: 12px;
  width: 70%;
  border-radius: 4px;
}

.skeletonCell {
  composes: skeletonBase;
  height: 13px;
  border-radius: 4px;
}

.skeletonBadge {
  composes: skeletonBase;
  height: 24px;
  width: 60px;
  border-radius: 20px;
}

.skeletonAction {
  composes: skeletonBase;
  height: 32px;
  width: 32px;
  border-radius: 8px;
}

.skeletonPage {
  composes: skeletonBase;
  height: 28px;
  width: 60px;
  border-radius: 6px;
}

.skeletonPageBtns {
  display: flex;
  gap: 6px;
}

.skeletonPageBtn {
  composes: skeletonBase;
  height: 32px;
  width: 32px;
  border-radius: 8px;
}














import styles from './DataTableSkeleton.module.scss';

interface DataTableSkeletonProps {
  rows?: number;
  columns?: number;
}

export default function DataTableSkeleton({
  rows = 6,
  columns = 4,
}: DataTableSkeletonProps) {
  // last column is always actions (badge + action button pattern)
  const colTypes = Array.from({ length: columns }, (_, i) => {
    if (i === columns - 1) return 'action';
    if (i === columns - 2) return 'badge';
    return 'text';
  });

  return (
    <div className={styles.wrapper}>

      {/* Toolbar */}
      <div className={styles.toolbar}>
        <div className={styles.skeletonSearch} />
        <div className={styles.skeletonCount} />
      </div>

      {/* Table */}
      <div className={styles.tableScroll}>
        <table>
          <thead>
            <tr>
              {colTypes.map((_, i) => (
                <th key={i}>
                  <div className={styles.skeletonHeader} />
                </th>
              ))}
            </tr>
          </thead>
          <tbody>
            {Array.from({ length: rows }).map((_, rowIdx) => (
              <tr key={rowIdx}>
                {colTypes.map((type, colIdx) => (
                  <td key={colIdx}>
                    {type === 'action' ? (
                      <div className={styles.skeletonAction} />
                    ) : type === 'badge' ? (
                      <div className={styles.skeletonBadge} />
                    ) : (
                      <div
                        className={styles.skeletonCell}
                        style={{ width: `${60 + ((rowIdx * colIdx * 7 + colIdx * 13) % 30)}%` }}
                      />
                    )}
                  </td>
                ))}
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      {/* Pagination */}
      <div className={styles.footer}>
        <div className={styles.skeletonPage} />
        <div className={styles.skeletonPageBtns}>
          {Array.from({ length: 5 }).map((_, i) => (
            <div key={i} className={styles.skeletonPageBtn} />
          ))}
        </div>
      </div>

    </div>
  );
}















import { ColumnDef } from '@tanstack/react-table';
import { useEffect, useState } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { RoleUser } from '../api/roleApi';
import DataTable from '../components/DataTable/DataTable';
import DataTableSkeleton from '../components/DataTable/DataTableSkeleton';
import type { AppDispatch, RootState } from '../store';
import { fetchRoles, updateRole } from '../store/slices/roleSlice';
import styles from './PageShell.module.scss';
import roleStyles from './RoleManagement.module.scss';

export default function RoleManagement() {
  const dispatch = useDispatch<AppDispatch>();
  const { users, loading, error, updating } = useSelector((state: RootState) => state.roles);

  const [editingId, setEditingId] = useState<number | null>(null);
  const [editingRole, setEditingRole] = useState<'user' | 'admin'>('user');

  useEffect(() => {
    dispatch(fetchRoles());
  }, [dispatch]);

  const handleEdit = (row: RoleUser) => {
    setEditingId(row.ms_user_id);
    setEditingRole(row.role);
  };

  const handleSave = async (ms_user_id: number) => {
    await dispatch(updateRole({ ms_user_id, role: editingRole }));
    setEditingId(null);
  };

  const handleCancel = () => setEditingId(null);

  const columns: ColumnDef<RoleUser, unknown>[] = [
    { accessorKey: 'username', header: 'User', size: 220 },
    { accessorKey: 'email', header: 'Email', size: 260 },
    {
      accessorKey: 'role',
      header: 'Access Role',
      size: 180,
      cell: ({ row }) =>
        editingId === row.original.ms_user_id ? (
          <div className={roleStyles.selectWrapper}>
            <select
              className={roleStyles.roleSelect}
              value={editingRole}
              onChange={(e) => setEditingRole(e.target.value as 'user' | 'admin')}
            >
              <option value="admin">Admin</option>
              <option value="user">User</option>
            </select>
            <span className={roleStyles.selectIcon}>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="6 9 12 15 18 9" />
              </svg>
            </span>
          </div>
        ) : (
          <span className={`${roleStyles.roleBadge} ${row.original.role === 'admin' ? roleStyles.admin : roleStyles.user}`}>
            {row.original.role === 'admin' ? 'Admin' : 'User'}
          </span>
        ),
    },
    {
      id: 'actions',
      header: 'Actions',
      enableSorting: false,
      size: 120,
      cell: ({ row }) =>
        editingId === row.original.ms_user_id ? (
          <div className={roleStyles.actions}>
            <button
              className={`${roleStyles.actionBtn} ${roleStyles.save}`}
              onClick={() => handleSave(row.original.ms_user_id)}
              disabled={updating === row.original.ms_user_id}
              title="Save"
            >
              {updating === row.original.ms_user_id ? (
                <span className={roleStyles.spinner} />
              ) : (
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
                  <polyline points="20 6 9 17 4 12" />
                </svg>
              )}
            </button>
            <button
              className={`${roleStyles.actionBtn} ${roleStyles.cancel}`}
              onClick={handleCancel}
              title="Cancel"
            >
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
                <line x1="18" y1="6" x2="6" y2="18" />
                <line x1="6" y1="6" x2="18" y2="18" />
              </svg>
            </button>
          </div>
        ) : (
          <div className={roleStyles.actions}>
            <button
              className={`${roleStyles.actionBtn} ${roleStyles.edit}`}
              onClick={() => handleEdit(row.original)}
              title="Edit"
            >
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
              </svg>
            </button>
          </div>
        ),
    },
  ];

  return (
    <div className={styles.page}>
      <div className={styles.pageHeader}>
        <h1 className={styles.title}>Role Management</h1>
        <p className={styles.description}>Manage roles and permissions across your organization.</p>
      </div>
      <div className={styles.pageContent}>
        {loading ? (
          <DataTableSkeleton rows={6} columns={4} />
        ) : error ? (
          <div className={roleStyles.stateBox}>
            <p className={roleStyles.errorText}>{error}</p>
            <button className={roleStyles.retryBtn} onClick={() => dispatch(fetchRoles())}>
              Retry
            </button>
          </div>
        ) : (
          <DataTable columns={columns} data={users} pageSize={6} />
        )}
      </div>
    </div>
  );
}
