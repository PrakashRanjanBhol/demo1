import { Component, OnInit, ChangeDetectorRef, ViewChild, ElementRef, SecurityContext } from '@angular/core';
import { DomSanitizer, SafeHtml } from '@angular/platform-browser';
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { trigger, state, style, transition, animate } from '@angular/animations';
import { ChunkedJsonParserService, ToolData, ApprovalRequest } from './chunked-json-parser.service';
import { marked } from 'marked';
import { markedHighlight } from 'marked-highlight';

declare var hljs: any;

// ... rest of interfaces remain same ...

@Component({
  selector: 'vibe-coding-chunked-json-parser',
  templateUrl: './chunked-json-parser.component.html',
  styleUrls: ['./chunked-json-parser.component.css'],
  animations: [
    trigger('fadeIn', [
      state('void', style({ opacity: 0 })),
      state('*', style({ opacity: 1 })),
      transition('void => *', animate('300ms ease-out')),
      transition('* => void', animate('300ms ease-in'))
    ])
  ]
})
export class ChunkedJsonParserComponent implements OnInit {
  // ... all properties remain same ...

  constructor(
    private parserService: ChunkedJsonParserService,
    private cdr: ChangeDetectorRef,
    private http: HttpClient,
    private sanitizer: DomSanitizer
  ) {
    this.configureMarked();
  }

  ngOnInit(): void {
    // Setup will happen on RUN click
  }

  // UPDATED: Configure marked with highlight extension
  private configureMarked(): void {
    marked.use(
      markedHighlight({
        langPrefix: 'hljs language-',
        highlight(code: string, lang: string) {
          if (typeof hljs !== 'undefined') {
            const language = hljs.getLanguage(lang) ? lang : 'plaintext';
            try {
              return hljs.highlight(code, { language }).value;
            } catch (e) {
              console.warn('Highlight error:', e);
              return code;
            }
          }
          return code;
        }
      })
    );

    marked.setOptions({
      breaks: true,
      gfm: true
    });
  }

  // ... rest of the code remains exactly the same ...
}
