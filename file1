/**
 * Save edited content
 */
saveEditedContent(): void {
  if (!this.selectedDetailItem || !this.selectedHistoryItem) {
    return;
  }

  const item = this.resultItems.find(i => i.id === this.editingItemId);
  if (!item) {
    return;
  }

  // Prepare API payload with fileID
  const fileId = this.selectedHistoryItem.id;
  let payload: { fileID: string; summary?: string; keywords?: string[] } = {
    fileID: fileId
  };

  if (this.editingItemType === 'summary') {
    payload.summary = this.editedContent;
  } else if (this.editingItemType === 'keywords') {
    const keywords = this.editedContent.split('\n')
      .map(k => k.trim())
      .filter(k => k.length > 0);
    payload.keywords = keywords;
  }

  // Set saving state
  this.isSaving = true;
  this.saveError = '';

  // Make API call
  this.workspaceResultService.updateFileAnalysis(payload)
    .pipe(takeUntil(this.destroy$))
    .subscribe({
      next: (response) => {
        console.log('Update successful:', response);
        
        // Update local data
        if (this.editingItemType === 'summary') {
          item.content = this.editedContent;
          const htmlContent: any = marked(this.editedContent);
          item.htmlContent = this.sanitizer.bypassSecurityTrustHtml(htmlContent);
        } else if (this.editingItemType === 'keywords') {
          const keywords = this.editedContent.split('\n')
            .map(k => k.trim())
            .filter(k => k.length > 0);
          item.keywords = keywords;
          item.content = keywords.map(k => `â€¢ ${k}`).join(' ');
        }

        // Update the selected detail item
        this.selectedDetailItem = { ...item };

        // Reset saving state
        this.isSaving = false;

        // Close edit mode and show normal view
        this.closeEditMode();
        
        // Reopen in view mode
        this.openDetail(item);
      },
      error: (error) => {
        console.error('Error updating analysis:', error);
        this.saveError = 'Failed to save changes. Please try again.';
        this.isSaving = false;
      }
    });
}
