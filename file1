/* Diff2Html Theme Support with parent container */
.pr-review-container ::ng-deep .d2h-wrapper,
.pr-review-container ::ng-deep .d2h-diff-table {
    background-color: var(--bitbucket-file-comparator-bg-primary) !important;
    color: var(--bitbucket-file-comparator-text-primary) !important;
}

/* Line numbers */
.pr-review-container ::ng-deep .d2h-code-linenumber,
.pr-review-container ::ng-deep .d2h-code-side-linenumber {
    background-color: var(--bitbucket-file-comparator-bg-tertiary) !important;
    border-color: var(--bitbucket-file-comparator-border-primary) !important;
    color: var(--bitbucket-file-comparator-text-secondary) !important;
}

/* Code lines */
.pr-review-container ::ng-deep .d2h-code-line,
.pr-review-container ::ng-deep .d2h-code-side-line {
    background-color: var(--bitbucket-file-comparator-bg-primary) !important;
    color: var(--bitbucket-file-comparator-text-primary) !important;
}

/* Empty cells in side-by-side */
.pr-review-container ::ng-deep .d2h-code-side-emptyplaceholder {
    background-color: var(--bitbucket-file-comparator-bg-tertiary) !important;
    border-color: var(--bitbucket-file-comparator-border-primary) !important;
}

/* Deletions (removed lines) */
.pr-review-container ::ng-deep .d2h-del,
.pr-review-container ::ng-deep .d2h-code-line.d2h-del,
.pr-review-container ::ng-deep .d2h-code-side-line.d2h-del {
    background-color: rgba(220, 38, 38, 0.15) !important;
}

.pr-review-container ::ng-deep .d2h-code-linenumber.d2h-del,
.pr-review-container ::ng-deep .d2h-code-side-linenumber.d2h-del {
    background-color: rgba(220, 38, 38, 0.2) !important;
    border-color: rgba(220, 38, 38, 0.3) !important;
}

/* Insertions (added lines) */
.pr-review-container ::ng-deep .d2h-ins,
.pr-review-container ::ng-deep .d2h-code-line.d2h-ins,
.pr-review-container ::ng-deep .d2h-code-side-line.d2h-ins {
    background-color: rgba(34, 197, 94, 0.15) !important;
}

.pr-review-container ::ng-deep .d2h-code-linenumber.d2h-ins,
.pr-review-container ::ng-deep .d2h-code-side-linenumber.d2h-ins {
    background-color: rgba(34, 197, 94, 0.2) !important;
    border-color: rgba(34, 197, 94, 0.3) !important;
}

/* Changed text highlighting within lines */
.pr-review-container ::ng-deep .d2h-del .d2h-change {
    background-color: rgba(220, 38, 38, 0.4) !important;
}

.pr-review-container ::ng-deep .d2h-ins .d2h-change {
    background-color: rgba(34, 197, 94, 0.4) !important;
}

/* Info section (file headers, hunks) */
.pr-review-container ::ng-deep .d2h-info {
    background-color: var(--bitbucket-file-comparator-bg-tertiary) !important;
    color: var(--bitbucket-file-comparator-accent-primary) !important;
    border-color: var(--bitbucket-file-comparator-border-primary) !important;
}

/* File wrapper */
.pr-review-container ::ng-deep .d2h-file-wrapper {
    border-color: var(--bitbucket-file-comparator-border-primary) !important;
}

/* Diff tbody */
.pr-review-container ::ng-deep .d2h-diff-tbody {
    background-color: var(--bitbucket-file-comparator-bg-primary) !important;
}

/* Table borders */
.pr-review-container ::ng-deep .d2h-diff-table tr,
.pr-review-container ::ng-deep .d2h-diff-table td {
    border-color: var(--bitbucket-file-comparator-border-primary) !important;
}

/* Code line content */
.pr-review-container ::ng-deep .d2h-code-line-ctn,
.pr-review-container ::ng-deep .d2h-code-side-line-ctn {
    color: var(--bitbucket-file-comparator-text-primary) !important;
}

/* Syntax highlighting adjustments */
.pr-review-container ::ng-deep .d2h-code-line-ctn .hljs,
.pr-review-container ::ng-deep .d2h-code-side-line-ctn .hljs {
    background-color: transparent !important;
}

/* Keywords */
.pr-review-container ::ng-deep .hljs-keyword,
.pr-review-container ::ng-deep .hljs-selector-tag,
.pr-review-container ::ng-deep .hljs-literal {
    color: #c792ea !important;
}

/* Strings */
.pr-review-container ::ng-deep .hljs-string,
.pr-review-container ::ng-deep .hljs-doctag {
    color: #c3e88d !important;
}

/* Numbers */
.pr-review-container ::ng-deep .hljs-number,
.pr-review-container ::ng-deep .hljs-attr {
    color: #f78c6c !important;
}

/* Comments */
.pr-review-container ::ng-deep .hljs-comment,
.pr-review-container ::ng-deep .hljs-quote {
    color: #676e95 !important;
    font-style: italic !important;
}

/* Functions */
.pr-review-container ::ng-deep .hljs-function,
.pr-review-container ::ng-deep .hljs-title {
    color: #82aaff !important;
}

/* Variables */
.pr-review-container ::ng-deep .hljs-variable,
.pr-review-container ::ng-deep .hljs-template-variable {
    color: #f07178 !important;
}

/* Classes */
.pr-review-container ::ng-deep .hljs-class,
.pr-review-container ::ng-deep .hljs-type {
    color: #ffcb6b !important;
}

/* Tags (HTML/XML) */
.pr-review-container ::ng-deep .hljs-tag {
    color: #f07178 !important;
}

/* Attributes */
.pr-review-container ::ng-deep .hljs-attribute {
    color: #c792ea !important;
}

/* Operators */
.pr-review-container ::ng-deep .hljs-operator,
.pr-review-container ::ng-deep .hljs-built_in {
    color: #89ddff !important;
}

/* Side-by-side specific adjustments */
.pr-review-container ::ng-deep .d2h-file-side-diff {
    background-color: var(--bitbucket-file-comparator-bg-primary) !important;
}

/* Context lines (unchanged) in side-by-side */
.pr-review-container ::ng-deep .d2h-cntx,
.pr-review-container ::ng-deep .d2h-code-side-line.d2h-cntx {
    background-color: var(--bitbucket-file-comparator-bg-primary) !important;
}

/* Deleted in side-by-side left column */
.pr-review-container ::ng-deep .d2h-file-side-diff .d2h-del.d2h-change {
    background-color: rgba(220, 38, 38, 0.25) !important;
}

/* Added in side-by-side right column */
.pr-review-container ::ng-deep .d2h-file-side-diff .d2h-ins.d2h-change {
    background-color: rgba(34, 197, 94, 0.25) !important;
}

/* Modified line highlighting adjustments */
.pr-review-container ::ng-deep .has-ai-comment {
    background-color: var(--bitbucket-file-comparator-highlight-comment) !important;
}

.pr-review-container ::ng-deep .has-ai-comment-accepted {
    background-color: var(--bitbucket-file-comparator-highlight-accepted) !important;
}

.pr-review-container ::ng-deep .has-ai-comment-rejected {
    background-color: var(--bitbucket-file-comparator-highlight-rejected) !important;
}

/* Scrollbar */
.pr-review-container ::ng-deep .d2h-wrapper::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}

.pr-review-container ::ng-deep .d2h-wrapper::-webkit-scrollbar-track {
    background: var(--bitbucket-file-comparator-bg-tertiary);
}

.pr-review-container ::ng-deep .d2h-wrapper::-webkit-scrollbar-thumb {
    background: var(--bitbucket-file-comparator-border-secondary);
    border-radius: 5px;
}

.pr-review-container ::ng-deep .d2h-wrapper::-webkit-scrollbar-thumb:hover {
    background: var(--bitbucket-file-comparator-text-secondary);
}

/* Comment row transitions */
.pr-review-container ::ng-deep .comment-row {
    background-color: var(--bitbucket-file-comparator-bg-overlay) !important;
    display: table-row !important;
    animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.pr-review-container ::ng-deep .comment-row.removing {
    animation: fadeOut 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.pr-review-container ::ng-deep .comment-row .comment-cell {
    padding: 0 !important;
    border: none !important;
    background-color: var(--bitbucket-file-comparator-bg-overlay) !important;
    display: table-cell !important;
    width: 100% !important;
}

/* Ensure comment cell spans full width in both views */
.pr-review-container ::ng-deep .d2h-file-side-diff .comment-row .comment-cell,
.pr-review-container ::ng-deep .d2h-file-diff .comment-row .comment-cell {
    width: 100% !important;
    max-width: 100% !important;
}

.pr-review-container ::ng-deep .comment-wrapper {
    width: 100% !important;
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    padding: 10px !important;
}

.pr-review-container ::ng-deep .comment-row .ai-comment-thread {
    width: 100% !important;
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    position: relative !important;
    left: 0 !important;
    top: 0 !important;
}

.pr-review-container ::ng-deep .comment-row .ai-comment {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
}

/* Force visibility in side-by-side mode */
.pr-review-container ::ng-deep .d2h-file-side-diff tbody .comment-row,
.pr-review-container ::ng-deep .d2h-wrapper .comment-row {
    display: table-row !important;
    visibility: visible !important;
}

.pr-review-container ::ng-deep .d2h-file-side-diff tbody .comment-row td,
.pr-review-container ::ng-deep .d2h-wrapper .comment-row td {
    display: table-cell !important;
    visibility: visible !important;
}

/* Theme toggle button */
.pr-review-container .theme-toggle-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    padding: 0;
    background: var(--bitbucket-file-comparator-bg-primary);
    border: 2px solid var(--bitbucket-file-comparator-border-primary);
    border-radius: 8px;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 1px 3px var(--bitbucket-file-comparator-comment-shadow);
}

.pr-review-container .theme-toggle-btn:hover {
    border-color: var(--bitbucket-file-comparator-accent-primary);
    background: var(--bitbucket-file-comparator-bg-tertiary);
    transform: translateY(-1px) rotate(15deg);
    box-shadow: 0 2px 6px rgba(0, 82, 204, 0.15);
}

.pr-review-container .theme-icon {
    display: block;
    line-height: 1;
}
