import { Component, Input, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

export interface FunctionData {
  function_name: string;
  function_code: string;
}

@Component({
  selector: 'app-function-editor',
  standalone: true,
  imports: [CommonModule, FormsModule],
  templateUrl: './function-editor.component.html',
  styleUrls: ['./function-editor.component.css']
})
export class FunctionEditorComponent implements OnInit {
  @Input() function: FunctionData | null = null;
  
  isEditMode: boolean = false;
  functionName: string = '';
  functionCode: string = '';
  isProcessing: boolean = false;

  ngOnInit(): void {
    if (this.function) {
      this.isEditMode = true;
      this.functionName = this.function.function_name;
      this.functionCode = this.function.function_code;
    }
  }

  get headerTitle(): string {
    return this.isEditMode ? 'Edit Function' : 'Create Function';
  }

  get buttonText(): string {
    if (this.isProcessing) {
      return this.isEditMode ? 'Updating...' : 'Creating...';
    }
    return this.isEditMode ? 'Update' : 'Create';
  }

  get isFormValid(): boolean {
    return this.functionName.trim().length > 0 && this.functionCode.trim().length > 0;
  }

  onCancel(): void {
    console.log('Cancel clicked');
    this.functionName = '';
    this.functionCode = '';
  }

  async onCreate(): Promise<void> {
    this.isProcessing = true;
    
    console.log(this.isEditMode ? 'Update clicked' : 'Create clicked');
    console.log('Function Name:', this.functionName);
    console.log('Function Code:', this.functionCode);
    
    try {
      // Simulate API call - replace with your actual API call
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      // Clear fields after successful creation/update
      this.functionName = '';
      this.functionCode = '';
    } catch (error) {
      console.error('Error:', error);
    } finally {
      this.isProcessing = false;
    }
  }
}
