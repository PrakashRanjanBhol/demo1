<!-- Inline Comment Box -->
<div 
  *ngIf="line.comment"
  class="ai-comment" 
  [id]="getCommentId(line.comment)"
  [ngClass]="{
    'accepted': getCommentState(line.comment).status === 'accepted',
    'rejected': getCommentState(line.comment).status === 'rejected',
    'processing': isProcessing(line.comment)
  }">







<!-- Inline Comment Box -->
<div 
  *ngIf="line.comment"
  class="ai-comment" 
  [id]="getCommentId(line.comment)"
  [ngClass]="{
    'accepted': getCommentData(line.comment).state.status === 'accepted',
    'rejected': getCommentData(line.comment).state.status === 'rejected',
    'processing': getCommentData(line.comment).isProcessing
  }">
  
  <div class="comment-header">
    <div>
      <span class="comment-severity" [ngClass]="line.comment.severity">
        {{ line.comment.severity }}
      </span>
      <span 
        class="comment-status" 
        *ngIf="getCommentData(line.comment).state.status !== 'pending'"
        [ngClass]="getCommentData(line.comment).state.status">
        {{ getCommentData(line.comment).state.status.toUpperCase() }}
      </span>
    </div>
    <span class="comment-line-info">Line {{ line.comment.line }}</span>
  </div>

  <div class="comment-text-display" *ngIf="!getCommentData(line.comment).isEditing">
    {{ getCommentData(line.comment).displayText }}
  </div>

  <textarea 
    class="comment-text-input" 
    *ngIf="getCommentData(line.comment).isEditing"
    [value]="getEditText(line.comment)"
    (input)="setEditText(line.comment, $any($event.target).value)"
    rows="4">
  </textarea>

  <div class="suggested-patch" *ngIf="line.comment.suggested_patch">
    <div class="suggested-patch-label">ðŸ’¡ Suggested Fix:</div>
    <pre>{{ line.comment.suggested_patch }}</pre>
  </div>

  <div class="comment-actions">
    <button 
      class="comment-btn accept" 
      *ngIf="!getCommentData(line.comment).isEditing && getCommentData(line.comment).state.status === 'pending'"
      [disabled]="getCommentData(line.comment).isActionDisabled"
      (click)="acceptComment(line.comment)">
      <span *ngIf="getCommentData(line.comment).processingAction !== 'accept'">âœ“ Accept</span>
      <span *ngIf="getCommentData(line.comment).processingAction === 'accept'" class="spinner-container">
        <span class="spinner"></span>
        <span>Accepting...</span>
      </span>
    </button>
    <button 
      class="comment-btn reject" 
      *ngIf="!getCommentData(line.comment).isEditing && getCommentData(line.comment).state.status === 'pending'"
      [disabled]="getCommentData(line.comment).isActionDisabled"
      (click)="rejectComment(line.comment)">
      <span *ngIf="getCommentData(line.comment).processingAction !== 'reject'">âœ— Reject</span>
      <span *ngIf="getCommentData(line.comment).processingAction === 'reject'" class="spinner-container">
        <span class="spinner"></span>
        <span>Rejecting...</span>
      </span>
    </button>
    <button 
      class="comment-btn modify" 
      *ngIf="!getCommentData(line.comment).isEditing && getCommentData(line.comment).state.status === 'pending'"
      [disabled]="getCommentData(line.comment).isActionDisabled"
      (click)="modifyComment(line.comment)">
      âœŽ Modify
    </button>
    <button 
      class="comment-btn save" 
      *ngIf="getCommentData(line.comment).isEditing"
      [disabled]="getCommentData(line.comment).isProcessing"
      (click)="saveComment(line.comment)">
      <span *ngIf="getCommentData(line.comment).processingAction !== 'save'">ðŸ’¾ Save</span>
      <span *ngIf="getCommentData(line.comment).processingAction === 'save'" class="spinner-container">
        <span class="spinner"></span>
        <span>Saving...</span>
      </span>
    </button>
    <button 
      class="comment-btn cancel" 
      *ngIf="getCommentData(line.comment).isEditing"
      [disabled]="getCommentData(line.comment).isProcessing"
      (click)="cancelModify(line.comment)">
      Cancel
    </button>
    
    <div class="comment-nav">
      <button 
        class="comment-btn nav prev-comment"
        [disabled]="getCommentNavigation(line.comment).isFirst || getCommentData(line.comment).isProcessing"
        (click)="goToPreviousComment(line.comment)"
        title="Previous Comment">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
        </svg>
      </button>
      <button 
        class="comment-btn nav next-comment"
        [disabled]="getCommentNavigation(line.comment).isLast || getCommentData(line.comment).isProcessing"
        (click)="goToNextComment(line.comment)"
        title="Next Comment">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
        </svg>
      </button>
    </div>
  </div>
</div>
