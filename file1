// MODIFIED approveAndContinue - Make parserService call non-blocking
public async approveAndContinue(): Promise<void> {
  if (this.currentApprovalRequest && !this.isApprovingChanges) {
    console.log('✅ APPROVED:', this.currentApprovalRequest.data);
    console.log('Saving code changes via API...\n');
    
    this.isApprovingChanges = true;
    this.cdr.detectChanges();
    
    try {
      const fileDetails = this.getFileDetails(this.currentApprovalRequest.data.content);
      
      if (fileDetails) {
        const payload = {
          tool: this.currentApprovalRequest.data.tool,
          file_path: fileDetails.file_path,
          file_name: fileDetails.file_name,
          original_code: fileDetails.original_code || '',
          modified_code: fileDetails.modified_code || '',
          reasoning: this.getReasoning(this.currentApprovalRequest.data.content),
          timestamp: new Date().toISOString()
        };
        
        await this.saveCodeChanges(payload);
        console.log('✅ Code changes saved successfully');
      }
      
      // MODIFIED: State changes BEFORE calling parser service
      this.showApprovalCard = false;
      this.isWaitingForApproval = false;
      this.currentApprovalRequest = null;
      this.showStreamingContainer = true;
      this.cdr.detectChanges();
      
      // MODIFIED: Call parser service asynchronously (non-blocking)
      setTimeout(() => {
        this.parserService.approveAndContinue();
        this.updateLists();
        this.scrollToBottom();
      }, 0);
      
    } catch (error) {
      console.error('❌ Failed to save code changes:', error);
      alert('Failed to save code changes. Please try again.');
      this.isApprovingChanges = false;
      this.cdr.detectChanges();
      return;
    }
    
    // Keep spinner for minimum duration
    setTimeout(() => {
      this.isApprovingChanges = false;
      this.cdr.detectChanges();
    }, 300);
  }
}

// MODIFIED rejectChanges - Make parserService call non-blocking
public rejectChanges(): void {
  if (this.currentApprovalRequest) {
    console.log('❌ REJECTED:', this.currentApprovalRequest.data);
    console.log('Continuing with next operation...\n');
    
    this.currentApprovalRequest.data.rejected = true;
    this.executedItems.push(this.currentApprovalRequest.data);
    
    // MODIFIED: State changes BEFORE calling parser service
    this.showApprovalCard = false;
    this.isWaitingForApproval = false;
    this.currentApprovalRequest = null;
    this.showStreamingContainer = true;
    this.cdr.detectChanges();
    
    // MODIFIED: Call parser service asynchronously (non-blocking)
    setTimeout(() => {
      this.parserService.approveAndContinue();
      this.updateLists();
      this.scrollToBottom();
    }, 0);
  }
}
