import { Component, Input, OnChanges, SimpleChanges, OnDestroy, ViewChild, ElementRef } from '@angular/core';
import { DomSanitizer, SafeHtml } from '@angular/platform-browser';
import { marked } from 'marked';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { WorkspaceResultService, AssessmentQuestion, MCQOption } from './workspace-result.service';

// ... keep all existing interfaces

@Component({
  selector: 'app-workspace',
  templateUrl: './workspace.component.html',
  styleUrls: ['./workspace.component.css']
})
export class WorkspaceComponent implements OnChanges, OnDestroy {
  @Input() selectedHistoryItem: HistoryItem | null = null;
  @ViewChild('assessmentComplete', { read: ElementRef }) assessmentCompleteRef!: ElementRef;
  
  // ... keep all existing properties

  constructor(
    private sanitizer: DomSanitizer,
    private workspaceResultService: WorkspaceResultService
  ) { }

  // ... keep all existing methods

  /**
   * Go to next question
   */
  nextQuestion(): void {
    const questions = this.getCurrentAssessment();
    
    if (this.currentQuestionIndex < questions.length - 1) {
      this.currentQuestionIndex++;
    } else {
      this.assessmentComplete = true;
      // Scroll to assessment complete section after view updates
      setTimeout(() => {
        this.scrollToAssessmentComplete();
      }, 100);
    }
  }

  /**
   * Scroll to assessment complete section
   */
  private scrollToAssessmentComplete(): void {
    if (this.assessmentCompleteRef && this.assessmentCompleteRef.nativeElement) {
      this.assessmentCompleteRef.nativeElement.scrollIntoView({
        behavior: 'smooth',
        block: 'center'
      });
    }
  }

  /**
   * Restart assessment
   */
  restartAssessment(): void {
    this.resetAssessment();
    // Optional: Scroll back to top of assessment
    setTimeout(() => {
      const assessmentContainer = document.querySelector('.assessment-container');
      if (assessmentContainer) {
        assessmentContainer.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    }, 100);
  }

  // ... keep all other existing methods
}









<!-- Assessment Complete Screen -->
<div class="assessment-complete" *ngIf="assessmentComplete" #assessmentComplete>
    <div class="complete-icon">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
    </div>
    <h3 class="complete-title">Assessment Complete!</h3>
    <p class="complete-message">You've completed all {{ getCurrentAssessment().length }} questions.</p>
    <button class="restart-btn" (click)="restartAssessment()">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
        </svg>
        Restart Assessment
    </button>
</div>


