<!-- ONLY SHOWING THE MODIFIED PART -->

<!-- Dynamic Result Content -->
<div class="result-content" *ngIf="selectedHistoryItem && !isLoadingResults && resultItems.length > 0">
    <!-- Result Items -->
    <div class="result-item" *ngFor="let item of resultItems"
        [class.selected]="selectedResultItemId === item.id">
        <div class="result-item-header">
            <div class="result-item-icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" [attr.d]="getIconPath(item.icon)" />
                </svg>
            </div>
            <div class="result-item-title-section">
                <h4 class="result-item-title">{{ item.title }}</h4>
            </div>
            <!-- Viewing Badge -->
            <div class="viewing-badge" *ngIf="selectedResultItemId === item.id">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <span>Viewing</span>
            </div>
            <div class="result-actions">
                <button class="result-action-icon-btn" title="Expand" (click)="openDetail(item)">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M15.75 4.5H19.5v3.75M19.5 4.5l-5.25 5.25M8.25 19.5H4.5v-3.75M4.5 19.5l5.25-5.25" />
                    </svg>
                </button>
                <button class="result-action-icon-btn" title="Copy" (click)="copyToClipboard(item.content)">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75" />
                    </svg>
                </button>
                <button class="result-action-icon-btn" title="Download" (click)="downloadContent(item)">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- MODIFIED PART: Add ellipsis for summary and questions -->
        <div class="result-item-content">
            <!-- Show ellipsis for summary and questions types -->
            <p class="result-text" 
               [class.text-ellipsis]="shouldShowEllipsis(item)"
               [class.text-expanded]="isExpanded(item.id)">
                {{ item.content }}
            </p>
            
            <!-- Show "Read more" / "Read less" button for summary and questions -->
            <button class="read-more-btn" 
                    *ngIf="shouldShowEllipsis(item) && isContentLong(item.content)"
                    (click)="toggleExpand(item.id)">
                {{ isExpanded(item.id) ? 'Read less' : 'Read more' }}
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" 
                     stroke="currentColor"
                     [class.rotate-180]="isExpanded(item.id)">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                </svg>
            </button>
        </div>
    </div>
</div>














import { Component, Input } from '@angular/core';
import { DomSanitizer, SafeHtml } from '@angular/platform-browser';
import { marked } from 'marked';

interface ResultItem {
  id: string;
  title: string;
  icon: string;
  content: string;
  type: 'summary' | 'keywords' | 'questions' | 'custom';
}

interface HistoryItem {
  id: string;
  name: string;
  displayDate: string;
  date: Date;
}

@Component({
  selector: 'app-workspace',
  templateUrl: './workspace.component.html',
  styleUrls: ['./workspace.component.css']
})
export class WorkspaceComponent {
  @Input() selectedHistoryItem: HistoryItem | null = null;
  @Input() resultItems: ResultItem[] = [];
  @Input() isLoadingResults: boolean = false;

  isDetailOpen = false;
  selectedItemName = '';
  selectedItemDate = '';
  selectedItemContent: SafeHtml = '';
  selectedResultItemId: string = '';

  // NEW: Track expanded items
  expandedItems: Set<string> = new Set();
  
  // NEW: Character limit for ellipsis
  private readonly CHAR_LIMIT = 200; // Adjust this value as needed

  constructor(private sanitizer: DomSanitizer) { }

  openDetail(item: ResultItem): void {
    this.selectedItemName = item.title;
    this.selectedItemDate = this.selectedHistoryItem?.displayDate || '';
    this.selectedResultItemId = item.id;

    // Convert content to markdown HTML
    const htmlContent: any = marked(item.content);
    this.selectedItemContent = this.sanitizer.bypassSecurityTrustHtml(htmlContent);

    this.isDetailOpen = true;
  }

  closeDetail(): void {
    this.isDetailOpen = false;
    this.selectedResultItemId = '';
  }

  getIconPath(iconType: string): string {
    const icons: { [key: string]: string } = {
      'document': 'M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z',
      'tag': 'M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z M6 6h.008v.008H6V6z',
      'question': 'M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z',
      'lightbulb': 'M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.383a14.406 14.406 0 01-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 10-7.517 0c.85.493 1.509 1.333 1.509 2.316V18'
    };
    return icons[iconType] || icons['document'];
  }

  copyToClipboard(content: string): void {
    navigator.clipboard.writeText(content).then(() => {
      console.log('Content copied to clipboard');
    });
  }

  downloadContent(item: ResultItem): void {
    const blob = new Blob([item.content], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `${item.title.replace(/\s+/g, '_')}.txt`;
    link.click();
    window.URL.revokeObjectURL(url);
  }

  // NEW METHODS FOR ELLIPSIS FUNCTIONALITY

  /**
   * Check if item should show ellipsis (only for summary and questions)
   */
  shouldShowEllipsis(item: ResultItem): boolean {
    return item.type === 'summary' || item.type === 'questions';
  }

  /**
   * Check if content is long enough to need "Read more" button
   */
  isContentLong(content: string): boolean {
    return content.length > this.CHAR_LIMIT;
  }

  /**
   * Check if item is currently expanded
   */
  isExpanded(itemId: string): boolean {
    return this.expandedItems.has(itemId);
  }

  /**
   * Toggle expand/collapse state for an item
   */
  toggleExpand(itemId: string): void {
    if (this.expandedItems.has(itemId)) {
      this.expandedItems.delete(itemId);
    } else {
      this.expandedItems.add(itemId);
    }
  }
}
















/* ADD THESE STYLES TO YOUR workspace.component.css */

/* Text Ellipsis Styles */
.result-text {
    font-size: 13px;
    line-height: 1.6;
    color: var(--text-color);
    margin: 0;
    transition: max-height 0.3s ease;
}

/* Collapsed state - show ellipsis */
.result-text.text-ellipsis {
    display: -webkit-box;
    -webkit-line-clamp: 3; /* Show 3 lines */
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Expanded state - show full content */
.result-text.text-ellipsis.text-expanded {
    display: block;
    -webkit-line-clamp: unset;
    overflow: visible;
}

/* Read More/Less Button */
.read-more-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    margin-top: 10px;
    padding: 6px 14px;
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.08), rgba(167, 139, 250, 0.08));
    border: 1px solid rgba(139, 92, 246, 0.2);
    border-radius: 6px;
    color: var(--primary-color);
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.read-more-btn:hover {
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(167, 139, 250, 0.15));
    border-color: var(--primary-color);
    transform: translateX(2px);
}

.read-more-btn svg {
    width: 14px;
    height: 14px;
    stroke: var(--primary-color);
    transition: transform 0.3s ease;
}

.read-more-btn svg.rotate-180 {
    transform: rotate(180deg);
}

/* Animation for smooth expand/collapse */
@keyframes expandText {
    from {
        max-height: 80px;
    }
    to {
        max-height: 1000px;
    }
}

.result-text.text-expanded {
    animation: expandText 0.3s ease-out forwards;
}

/* Adjust result-item-content padding when button is present */
.result-item-content:has(.read-more-btn) {
    padding-bottom: 16px;
}

/* Optional: Add fade effect at the bottom of truncated text */
.result-text.text-ellipsis:not(.text-expanded)::after {
    content: '';
    position: absolute;
    bottom: 0;
    right: 0;
    width: 100%;
    height: 1.5em;
    background: linear-gradient(to bottom, transparent, var(--bg-color));
    pointer-events: none;
}

.result-item-content {
    position: relative; /* Required for ::after positioning */
}
