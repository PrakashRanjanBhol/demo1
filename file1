<!-- Updated Date Range Picker Section - Replace the .date-range-section div -->

<div class="date-range-section">
  <label class="filter-label">
    <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
    </svg>
    Date Range
  </label>
  <div class="date-range-inputs">
    <div class="date-input-wrapper">
      <input 
        type="date" 
        class="date-input" 
        [(ngModel)]="startDate"
        [max]="endDate || undefined">
    </div>
    <span class="date-separator">to</span>
    <div class="date-input-wrapper">
      <input 
        type="date" 
        class="date-input" 
        [(ngModel)]="endDate"
        [min]="startDate || undefined">
    </div>
  </div>
  <div class="date-actions">
    <button 
      class="apply-dates-btn" 
      [disabled]="!startDate && !endDate"
      (click)="applyDateFilter()">
      <svg class="apply-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
      </svg>
      Apply
    </button>
    <button 
      class="clear-dates-btn" 
      *ngIf="startDate || endDate"
      (click)="clearDateRange()">
      <svg class="clear-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
      Clear
    </button>
  </div>
</div>













/* Updated CSS for Date Range Picker with date input type - Replace/Add these styles */

.date-range-section {
  margin-bottom: 12px;
}

.filter-label {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  font-weight: 600;
  color: var(--bitbucket-prs-text-secondary);
  margin-bottom: 8px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.label-icon {
  width: 14px;
  height: 14px;
  color: var(--bitbucket-prs-accent-primary);
}

.date-range-inputs {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
}

.date-input-wrapper {
  position: relative;
  flex: 1;
}

.date-input {
  width: 100%;
  padding: 10px 12px;
  background: var(--bitbucket-prs-bg-secondary);
  border: 1px solid var(--bitbucket-prs-border-primary);
  border-radius: 6px;
  color: var(--bitbucket-prs-text-secondary);
  font-size: 12px;
  outline: none;
  transition: all 0.2s;
  cursor: pointer;
}

.date-input::-webkit-calendar-picker-indicator {
  cursor: pointer;
  filter: invert(0.7);
  opacity: 0.8;
}

.date-input::-webkit-calendar-picker-indicator:hover {
  opacity: 1;
}

/* Light mode calendar icon */
[data-theme="light"] .date-input::-webkit-calendar-picker-indicator {
  filter: invert(0.5);
}

.date-input::placeholder {
  color: var(--bitbucket-prs-text-muted);
}

.date-input:focus {
  background: var(--bitbucket-prs-bg-hover);
  border-color: var(--bitbucket-prs-accent-primary);
  box-shadow: var(--bitbucket-prs-shadow-focus);
}

.date-separator {
  font-size: 11px;
  color: var(--bitbucket-prs-text-tertiary);
  font-weight: 500;
  padding: 0 2px;
}

.date-actions {
  display: flex;
  gap: 6px;
}

.apply-dates-btn {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 8px 12px;
  background: var(--bitbucket-prs-accent-gradient);
  border: none;
  border-radius: 6px;
  color: #fff;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.apply-dates-btn:hover:not(:disabled) {
  opacity: 0.9;
  transform: translateY(-1px);
}

.apply-dates-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.apply-icon {
  width: 16px;
  height: 16px;
}

.clear-dates-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 8px 12px;
  background: transparent;
  border: 1px solid var(--bitbucket-prs-border-primary);
  border-radius: 6px;
  color: var(--bitbucket-prs-text-tertiary);
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}

.clear-dates-btn:hover {
  background: var(--bitbucket-prs-bg-hover);
  border-color: var(--bitbucket-prs-border-secondary);
  color: var(--bitbucket-prs-text-secondary);
}

.clear-icon {
  width: 14px;
  height: 14px;
}














// Updated TypeScript Component - Replace date-related properties and methods

export class PrSidebarComponent implements OnInit {
  // ... existing properties ...
  
  // Date range properties (now using string for HTML5 date input - format: YYYY-MM-DD)
  startDate: string = '';
  endDate: string = '';
  appliedStartDate: string = '';
  appliedEndDate: string = '';

  // ... existing methods ...

  applyDateFilter(): void {
    this.appliedStartDate = this.startDate;
    this.appliedEndDate = this.endDate;
    this.updatePRList();
  }

  clearDateRange(): void {
    this.startDate = '';
    this.endDate = '';
    this.appliedStartDate = '';
    this.appliedEndDate = '';
    this.updatePRList();
  }

  // Helper method to convert date string (YYYY-MM-DD) to DD-MM-YYYY for display if needed
  private formatDateToDisplay(dateString: string): string {
    if (!dateString) return '';
    const [year, month, day] = dateString.split('-');
    return `${day}-${month}-${year}`;
  }

  // Helper method to parse date string for comparison
  private parseDate(dateString: string): Date | null {
    if (!dateString) return null;
    return new Date(dateString);
  }

  // Update the getFilteredPRs method to include date filtering
  private getFilteredPRs(): PullRequest[] {
    let filtered = this.prData;

    // Apply search filter
    if (this.searchQuery) {
      const query = this.searchQuery.toLowerCase();
      filtered = filtered.filter(pr => {
        return (
          pr.title.toLowerCase().includes(query) ||
          pr.author.toLowerCase().includes(query) ||
          pr.reviewers.some(reviewer => reviewer.toLowerCase().includes(query)) ||
          pr.id.toString().includes(query) ||
          pr.state.toLowerCase().includes(query)
        );
      });
    }

    // Apply date range filter (only when Apply button is clicked)
    if (this.appliedStartDate || this.appliedEndDate) {
      filtered = filtered.filter(pr => {
        // You'll need to add a 'created_at' or 'updated_at' field to your PR data
        // For now, this is a placeholder implementation
        if (!pr.created_at) return true; // Skip filtering if no date field
        
        const prDate = this.parseDate(pr.created_at);
        if (!prDate) return true;

        const startDateObj = this.parseDate(this.appliedStartDate);
        const endDateObj = this.parseDate(this.appliedEndDate);

        if (startDateObj) {
          startDateObj.setHours(0, 0, 0, 0);
          if (prDate < startDateObj) {
            return false;
          }
        }

        if (endDateObj) {
          endDateObj.setHours(23, 59, 59, 999);
          if (prDate > endDateObj) {
            return false;
          }
        }

        return true;
      });
    }

    return filtered;
  }

  // ... rest of the component ...
}

// Update your PullRequest interface to include date field
interface PullRequest {
  id: number;
  title: string;
  state: 'OPEN' | 'MERGED';
  author: string;
  reviewers: string[];
  user_comments: number;
  url: string;
  created_at?: string; // Add this field (format: 'YYYY-MM-DD' or ISO date string)
  updated_at?: string; // Or use this field
}

// Example PR data with dates:
/*
prData: PullRequest[] = [
  {
    id: 1,
    title: 'Sample PR',
    state: 'OPEN',
    author: 'Person4',
    reviewers: ['person1', 'person2', 'person3'],
    user_comments: 3,
    url: 'http://abc',
    created_at: '2024-01-15' // Add date in YYYY-MM-DD format
  },
  // ... more PRs with dates
];
*/
