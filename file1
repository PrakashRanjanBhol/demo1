import { Component, Input, OnChanges, SimpleChanges, OnDestroy } from '@angular/core';
import { DomSanitizer, SafeHtml } from '@angular/platform-browser';
import { marked } from 'marked';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { WorkspaceResultService, FAQ } from './workspace-result.service';

interface ResultItem {
  id: string;
  title: string;
  icon: string;
  content: string;
  type: 'summary' | 'keywords' | 'questions' | 'custom';
  keywords?: string[];
  faqs?: FAQ[];
  htmlContent?: SafeHtml; // Add this for rendered markdown
}

// ... rest of the interfaces remain the same

@Component({
  selector: 'app-workspace',
  templateUrl: './workspace.component.html',
  styleUrls: ['./workspace.component.css']
})
export class WorkspaceComponent implements OnChanges, OnDestroy {
  // ... all existing properties remain the same

  /**
   * Map API response to result items
   */
  private mapResponseToResultItems(data: any): void {
    this.resultItems = [];

    // Add Summary with markdown rendering
    if (data.summary) {
      const htmlContent: any = marked(data.summary);
      this.resultItems.push({
        id: 'summary-1',
        title: 'Summary',
        icon: 'document',
        content: data.summary, // Keep original for copy/download
        type: 'summary',
        htmlContent: this.sanitizer.bypassSecurityTrustHtml(htmlContent) // Add rendered HTML
      });
    }

    // Add Keywords
    if (data.keywords && Array.isArray(data.keywords) && data.keywords.length > 0) {
      this.resultItems.push({
        id: 'keywords-1',
        title: 'Key Topics',
        icon: 'tag',
        content: data.keywords.map(k => `â€¢ ${k}`).join(' '),
        type: 'keywords',
        keywords: data.keywords
      });
    }

    // Add FAQ
    if (data.faq && Array.isArray(data.faq) && data.faq.length > 0) {
      const faqContent = data.faq
        .map((item: FAQ, index: number) => 
          `Q${index + 1}: ${item.question}\nA: ${item.answer}`
        )
        .join('\n\n');

      this.resultItems.push({
        id: 'faq-1',
        title: 'Frequently Asked Questions',
        icon: 'question',
        content: faqContent,
        type: 'questions',
        faqs: data.faq
      });
    }
  }

  // ... rest of the methods remain the same
}







<!-- MODIFIED CONTENT SECTION - Different display for keywords and summary -->
<div class="result-item-content">
    <!-- KEYWORDS - Show as chips -->
    <div *ngIf="item.type === 'keywords'" class="keywords-chips-container">
        <div class="keyword-chip" *ngFor="let keyword of getKeywordsArray(item); let i = index"
            [style.background]="getChipBackground(i)" [style.border-color]="getChipBorderColor(i)">
            <span class="chip-text">{{ keyword }}</span>
            <button class="chip-remove-btn" (click)="removeKeyword(item.id, keyword)"
                title="Remove keyword">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <!-- Show message if all keywords removed -->
        <p class="no-keywords-message" *ngIf="getKeywordsArray(item).length === 0">
            No keywords available
        </p>
    </div>

    <!-- SUMMARY - Show with markdown rendering -->
    <div *ngIf="item.type === 'summary'" class="summary-markdown-content">
        <div class="markdown-content-inline" [innerHTML]="item.htmlContent"></div>
    </div>

    <!-- QUESTIONS - Show with ellipsis -->
    <div *ngIf="item.type === 'questions'">
        <p class="result-text" [class.text-ellipsis]="shouldShowEllipsis(item) && !isExpanded(item.id)"
            [class.text-expanded]="isExpanded(item.id)">
            {{ item.content }}
        </p>

        <button class="read-more-btn" *ngIf="shouldShowEllipsis(item) && isContentLong(item.content)"
            (click)="toggleExpand(item.id)">
            {{ isExpanded(item.id) ? 'Read less' : 'Read more' }}
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor" [class.rotate-180]="isExpanded(item.id)">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
            </svg>
        </button>
    </div>
</div>













/* Summary Markdown Content - Inline rendering */
.summary-markdown-content {
    width: 100%;
}

.markdown-content-inline {
    line-height: 1.7;
    color: var(--text-color);
    font-size: 13px;
}

.markdown-content-inline h1 {
    font-size: 18px;
    font-weight: 700;
    margin: 12px 0 8px 0;
    color: var(--text-color);
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 6px;
}

.markdown-content-inline h2 {
    font-size: 16px;
    font-weight: 700;
    margin: 10px 0 6px 0;
    color: var(--text-color);
}

.markdown-content-inline h3 {
    font-size: 14px;
    font-weight: 700;
    margin: 8px 0 4px 0;
    color: var(--text-color);
}

.markdown-content-inline h4,
.markdown-content-inline h5,
.markdown-content-inline h6 {
    font-size: 13px;
    font-weight: 600;
    margin: 6px 0 4px 0;
    color: var(--text-color);
}

.markdown-content-inline p {
    margin: 8px 0;
    line-height: 1.7;
}

.markdown-content-inline ul,
.markdown-content-inline ol {
    margin: 8px 0;
    padding-left: 20px;
}

.markdown-content-inline li {
    margin: 4px 0;
    line-height: 1.6;
}

.markdown-content-inline strong {
    font-weight: 700;
    color: var(--primary-color);
}

.markdown-content-inline em {
    font-style: italic;
}

.markdown-content-inline blockquote {
    border-left: 3px solid var(--primary-color);
    padding-left: 12px;
    margin: 12px 0;
    font-style: italic;
    opacity: 0.9;
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.03), rgba(167, 139, 250, 0.03));
    padding: 8px 12px;
    border-radius: 4px;
}

.markdown-content-inline hr {
    border: none;
    border-top: 1px solid var(--border-color);
    margin: 16px 0;
}

.markdown-content-inline code {
    background-color: rgba(139, 92, 246, 0.1);
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.9em;
    font-family: 'Courier New', monospace;
    color: var(--primary-color);
    border: 1px solid rgba(139, 92, 246, 0.2);
}

.markdown-content-inline pre {
    background-color: rgba(139, 92, 246, 0.05);
    padding: 12px;
    border-radius: 6px;
    overflow-x: auto;
    margin: 12px 0;
    border: 1px solid rgba(139, 92, 246, 0.2);
}

.markdown-content-inline pre code {
    background-color: transparent;
    padding: 0;
    border: none;
    color: var(--text-color);
}

.markdown-content-inline a {
    color: var(--primary-color);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-bottom-color 0.2s ease;
}

.markdown-content-inline a:hover {
    border-bottom-color: var(--primary-color);
}

.markdown-content-inline table {
    width: 100%;
    border-collapse: collapse;
    margin: 12px 0;
}

.markdown-content-inline th,
.markdown-content-inline td {
    padding: 8px;
    border: 1px solid var(--border-color);
    text-align: left;
}

.markdown-content-inline th {
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(167, 139, 250, 0.1));
    font-weight: 600;
}

.markdown-content-inline img {
    max-width: 100%;
    height: auto;
    border-radius: 6px;
    margin: 8px 0;
}

/* First paragraph styling */
.markdown-content-inline > p:first-child {
    margin-top: 0;
}

/* Last element margin */
.markdown-content-inline > *:last-child {
    margin-bottom: 0;
}
