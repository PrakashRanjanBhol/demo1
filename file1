<!-- Updated PR Card - Replace all PR card divs in your template -->

<!-- For Status View - Open PRs Section -->
<div 
  class="pr-card" 
  [class.selected]="selectedPRId === pr.id"
  *ngFor="let pr of openPRs"
  (click)="selectPR(pr)">
  <div class="pr-header">
    <div class="pr-state-container">
      <svg class="pr-state-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="18" cy="18" r="3"/>
        <circle cx="6" cy="6" r="3"/>
        <path d="M13 6h3a2 2 0 0 1 2 2v7"/>
        <line x1="6" y1="9" x2="6" y2="21"/>
      </svg>
      <span class="pr-state" [class.open]="pr.state === 'OPEN'" [class.merged]="pr.state === 'MERGED'">
        {{ pr.state }}
      </span>
    </div>
    <span class="pr-id">#{{ pr.id }}</span>
  </div>
  <div class="pr-title">{{ pr.title }}</div>
  <div class="pr-author">
    <div class="author-avatar">{{ getInitials(pr.author) }}</div>
    <span>{{ pr.author }}</span>
  </div>
  <div class="pr-footer">
    <div class="comment-count" [class.has-comments]="pr.user_comments > 0">
      <svg class="comment-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
      </svg>
      <span>{{ pr.user_comments }} comment{{ pr.user_comments !== 1 ? 's' : '' }}</span>
    </div>
    <div class="pr-actions">
      <a [href]="pr.url" class="view-link" (click)="stopPropagation($event)">
        Auto Review
      </a>
      <span class="action-separator">|</span>
      <a [href]="pr.url" class="view-link" (click)="stopPropagation($event)">
        View →
      </a>
    </div>
  </div>
</div>

<!-- For Status View - Merged PRs Section -->
<div 
  class="pr-card" 
  [class.selected]="selectedPRId === pr.id"
  *ngFor="let pr of mergedPRs"
  (click)="selectPR(pr)">
  <div class="pr-header">
    <div class="pr-state-container">
      <svg class="pr-state-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="18" cy="18" r="3"/>
        <circle cx="6" cy="6" r="3"/>
        <path d="M13 6h3a2 2 0 0 1 2 2v7"/>
        <line x1="6" y1="9" x2="6" y2="21"/>
      </svg>
      <span class="pr-state" [class.open]="pr.state === 'OPEN'" [class.merged]="pr.state === 'MERGED'">
        {{ pr.state }}
      </span>
    </div>
    <span class="pr-id">#{{ pr.id }}</span>
  </div>
  <div class="pr-title">{{ pr.title }}</div>
  <div class="pr-author">
    <div class="author-avatar">{{ getInitials(pr.author) }}</div>
    <span>{{ pr.author }}</span>
  </div>
  <div class="pr-footer">
    <div class="comment-count" [class.has-comments]="pr.user_comments > 0">
      <svg class="comment-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
      </svg>
      <span>{{ pr.user_comments }} comment{{ pr.user_comments !== 1 ? 's' : '' }}</span>
    </div>
    <div class="pr-actions">
      <a [href]="pr.url" class="view-link" (click)="stopPropagation($event)">
        Auto Review
      </a>
      <span class="action-separator">|</span>
      <a [href]="pr.url" class="view-link" (click)="stopPropagation($event)">
        View →
      </a>
    </div>
  </div>
</div>

<!-- For Activity View -->
<div 
  class="pr-card" 
  [class.selected]="selectedPRId === pr.id"
  *ngFor="let pr of filteredAndSortedPRs"
  (click)="selectPR(pr)">
  <div class="pr-header">
    <div class="pr-state-container">
      <svg class="pr-state-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="18" cy="18" r="3"/>
        <circle cx="6" cy="6" r="3"/>
        <path d="M13 6h3a2 2 0 0 1 2 2v7"/>
        <line x1="6" y1="9" x2="6" y2="21"/>
      </svg>
      <span class="pr-state" [class.open]="pr.state === 'OPEN'" [class.merged]="pr.state === 'MERGED'">
        {{ pr.state }}
      </span>
    </div>
    <span class="pr-id">#{{ pr.id }}</span>
  </div>
  <div class="pr-title">{{ pr.title }}</div>
  <div class="pr-author">
    <div class="author-avatar">{{ getInitials(pr.author) }}</div>
    <span>{{ pr.author }}</span>
  </div>
  <div class="pr-footer">
    <div class="comment-count" [class.has-comments]="pr.user_comments > 0">
      <svg class="comment-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
      </svg>
      <span>{{ pr.user_comments }} comment{{ pr.user_comments !== 1 ? 's' : '' }}</span>
    </div>
    <div class="pr-actions">
      <a [href]="pr.url" class="view-link" (click)="stopPropagation($event)">
        Auto Review
      </a>
      <span class="action-separator">|</span>
      <a [href]="pr.url" class="view-link" (click)="stopPropagation($event)">
        View →
      </a>
    </div>
  </div>
</div>












/* Add/Update these styles for selected PR card highlight */

/* Fade-in animation */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Apply animation to PR cards */
.pr-card {
  background: var(--bitbucket-prs-bg-tertiary);
  border: 1px solid var(--bitbucket-prs-border-primary);
  border-radius: 8px;
  padding: 14px;
  margin-bottom: 12px;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  
  /* Add animation */
  animation: fadeInUp 0.4s ease-out forwards;
  opacity: 0;
}

/* Stagger animation for each card */
.pr-card:nth-child(1) { animation-delay: 0.05s; }
.pr-card:nth-child(2) { animation-delay: 0.1s; }
.pr-card:nth-child(3) { animation-delay: 0.15s; }
.pr-card:nth-child(4) { animation-delay: 0.2s; }
.pr-card:nth-child(5) { animation-delay: 0.25s; }
.pr-card:nth-child(6) { animation-delay: 0.3s; }
.pr-card:nth-child(7) { animation-delay: 0.35s; }
.pr-card:nth-child(8) { animation-delay: 0.4s; }
.pr-card:nth-child(9) { animation-delay: 0.45s; }
.pr-card:nth-child(10) { animation-delay: 0.5s; }

/* For cards beyond 10, use a general rule */
.pr-card:nth-child(n+11) { animation-delay: 0.55s; }

.pr-card:hover {
  background: var(--bitbucket-prs-bg-hover);
  border-color: var(--bitbucket-prs-border-secondary);
  transform: translateY(-1px);
}

/* Selected PR Card Style */
.pr-card.selected {
  background: var(--bitbucket-prs-bg-hover);
  border: 2px solid var(--bitbucket-prs-accent-primary);
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
  transform: translateY(-2px);
}

/* Selected card hover - maintain the selected state */
.pr-card.selected:hover {
  background: var(--bitbucket-prs-bg-hover);
  border-color: var(--bitbucket-prs-accent-primary);
  transform: translateY(-2px);
  box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
}

/* Add a subtle left border accent for selected card */
.pr-card.selected::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 4px;
  background: var(--bitbucket-prs-accent-gradient);
  border-radius: 8px 0 0 8px;
}

/* Selected card icon animation */
.pr-card.selected .pr-state-icon {
  transform: scale(1.1);
}

/* Optional: Add subtle glow effect for selected card in dark mode */
:root .pr-card.selected {
  box-shadow: 
    0 0 0 3px rgba(99, 102, 241, 0.1),
    0 4px 12px rgba(99, 102, 241, 0.15);
}

/* Light mode selected card */
[data-theme="light"] .pr-card.selected {
  box-shadow: 
    0 0 0 3px rgba(99, 102, 241, 0.15),
    0 4px 12px rgba(99, 102, 241, 0.1);
}









// Add this property and method to your component class

export class PrSidebarComponent implements OnInit {
  // ... existing properties ...
  
  // Track selected PR
  selectedPRId: number | null = null;

  // ... existing methods ...

  // Select a PR card
  selectPR(pr: PullRequest): void {
    // Toggle selection: if clicking the same PR, deselect it
    if (this.selectedPRId === pr.id) {
      this.selectedPRId = null;
    } else {
      this.selectedPRId = pr.id;
    }
    
    // Optional: You can also emit an event or perform other actions here
    // For example, load PR details, update a parent component, etc.
    console.log('Selected PR:', pr);
    
    // Optional: If you want to open the PR URL when selected (remove if not needed)
    // window.open(pr.url, '_blank');
  }

  // Update the openPR method to work with selection
  openPR(url: string): void {
    window.open(url, '_blank');
  }

  // ... rest of the component ...
}

// Optional: If you want to emit the selected PR to a parent component
/*
import { Component, OnInit, Output, EventEmitter } from '@angular/core';

export class PrSidebarComponent implements OnInit {
  @Output() prSelected = new EventEmitter<PullRequest>();
  
  selectedPRId: number | null = null;

  selectPR(pr: PullRequest): void {
    if (this.selectedPRId === pr.id) {
      this.selectedPRId = null;
      this.prSelected.emit(null);
    } else {
      this.selectedPRId = pr.id;
      this.prSelected.emit(pr);
    }
  }
}
*/

// Optional: If you want to handle keyboard navigation for selected cards
/*
export class PrSidebarComponent implements OnInit {
  selectedPRId: number | null = null;

  @HostListener('document:keydown', ['$event'])
  handleKeyboardEvent(event: KeyboardEvent) {
    if (!this.selectedPRId) return;

    const currentPRs = this.currentSort === 'status' 
      ? [...this.openPRs, ...this.mergedPRs] 
      : this.filteredAndSortedPRs;
    
    const currentIndex = currentPRs.findIndex(pr => pr.id === this.selectedPRId);
    
    if (event.key === 'ArrowDown' && currentIndex < currentPRs.length - 1) {
      event.preventDefault();
      this.selectedPRId = currentPRs[currentIndex + 1].id;
    } else if (event.key === 'ArrowUp' && currentIndex > 0) {
      event.preventDefault();
      this.selectedPRId = currentPRs[currentIndex - 1].id;
    } else if (event.key === 'Enter') {
      event.preventDefault();
      const selectedPR = currentPRs[currentIndex];
      window.open(selectedPR.url, '_blank');
    } else if (event.key === 'Escape') {
      event.preventDefault();
      this.selectedPRId = null;
    }
  }
}
*/
