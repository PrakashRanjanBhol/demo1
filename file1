// Update the @Output decorator section at the top of the component class:
@Output() onGenerate = new EventEmitter<{ file: any, prompts: string, mode: 'new' }>();
@Output() onFileRemoved = new EventEmitter<{ id: string | number, name: string }>();
@Output() onGenerationComplete = new EventEmitter<{ id: number, status: 'Success' | 'Failed' }>();
@Output() onFileUploaded = new EventEmitter<{ id: number, original_name: string, created_at: string }>();




// Update the uploadFileViaService method:
private uploadFileViaService(fileWithStatus: FileWithStatus): Promise<void> {
  return new Promise((resolve, reject) => {
    const sub = this.uploadGenerateService.uploadFile(fileWithStatus.file).subscribe({
      next: (event: any) => {
        if (event.type === HttpEventType.UploadProgress) {
          if (event.total) {
            fileWithStatus.progress = Math.round((100 * event.loaded) / event.total);
          }
        } else if (event.type === HttpEventType.Response) {
          const response = event.body as UploadResponse;
          if (response.status === 'Success') {
            fileWithStatus.uploadedFileId = response.data.id;
            fileWithStatus.uploadedFileName = response.data.original_name;
            fileWithStatus.uploadedAt = response.data.created_at;
            console.log('Upload successful:', response);
            
            // Emit upload success event to parent
            this.onFileUploaded.emit({
              id: response.data.id,
              original_name: response.data.original_name,
              created_at: response.data.created_at
            });
            
            resolve();
          } else {
            reject(new Error('Upload failed with status: ' + response.status));
          }
        }
      },
      error: (error) => {
        console.error('Upload error:', error);
        reject(error);
      }
    });
    this.subscriptions.push(sub);
  });
}












// In your parent component template:
<app-upload-generate 
  [requestFile]="selectedFile"
  (onGenerate)="handleGenerate($event)"
  (onFileRemoved)="handleFileRemoved($event)"
  (onGenerationComplete)="handleGenerationComplete($event)"
  (onFileUploaded)="handleFileUploaded($event)">
</app-upload-generate>

// In your parent component class:
handleFileUploaded(event: { id: number, original_name: string, created_at: string }): void {
  console.log('File uploaded successfully:', event);
  // Handle the uploaded file - e.g., add to file list, update UI, etc.
  // This will be called for each file that uploads successfully
}

handleGenerationComplete(event: { id: number, status: 'Success' | 'Failed' }): void {
  console.log('Generation completed:', event);
  
  if (event.status === 'Success') {
    console.log(`File ${event.id} generated successfully`);
  } else {
    console.log(`File ${event.id} generation failed`);
  }
}

handleFileRemoved(event: { id: string | number, name: string }): void {
  console.log('File removed:', event);
}

handleGenerate(event: { file: any, prompts: string, mode: 'new' }): void {
  console.log('Generate requested:', event);
}
