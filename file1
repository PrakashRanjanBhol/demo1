deleteFiles(fileIds: number[]): Observable<ApiResponse> {
    const url = `${this.baseUrl}/content_analytics/files/delete/`;

    const body = {
        fileID: fileIds
    };

    const headers = new HttpHeaders({
        'Content-Type': 'application/json'
    });

    return this.http.post<ApiResponse>(url, body, { headers });
}





isDeleting: boolean = false;




executeDelete(): void {
  if (this.selectedForDelete.size === 0 || this.isDeleting) return;

  const idsToDelete = Array.from(this.selectedForDelete);
  const numericIds = idsToDelete.map(id => Number(id));

  this.isDeleting = true;

  this.historyService.deleteFiles(numericIds).subscribe({
    next: () => {
      if (this.selectedHistoryItem && idsToDelete.includes(this.selectedHistoryItem.id)) {
        this.selectedHistoryItem = null;
      }

      if (this.addedToGenerationId && idsToDelete.includes(this.addedToGenerationId)) {
        this.addedToGenerationId = null;
      }

      this.historyItems = this.historyItems.filter(item => !this.selectedForDelete.has(item.id));
      this.selectedForDelete.clear();
      this.showDeleteConfirm = false;
      this.isDeleteMode = false;
      this.isDeleting = false;
    },
    error: () => {
      this.isDeleting = false;
      // popup remains open on failure
    }
  });
}






<div class="delete-popup-actions">
    <button class="delete-popup-cancel" (click)="cancelDeleteConfirm()" [disabled]="isDeleting">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
        Cancel
    </button>
    <button class="delete-popup-confirm" (click)="executeDelete()" [disabled]="isDeleting">
        <!-- Inline spinner shown while deleting -->
        <svg *ngIf="isDeleting" class="delete-spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
            </path>
        </svg>
        <!-- Delete icon shown when idle -->
        <svg *ngIf="!isDeleting" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round"
                d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
        </svg>
        {{ isDeleting ? 'Deleting...' : 'Yes, Delete' }}
    </button>
</div>






/* Delete button spinner */
.delete-spinner {
    width: 15px;
    height: 15px;
    stroke: white;
    animation: spin 0.8s linear infinite;
    flex-shrink: 0;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to   { transform: rotate(360deg); }
}

/* Cancel button disabled state during delete */
.delete-popup-cancel:disabled {
    opacity: 0.45;
    cursor: not-allowed;
    pointer-events: none;
}

/* Confirm button disabled state during delete */
.delete-popup-confirm:disabled {
    cursor: not-allowed;
    opacity: 0.85;
    transform: none;
}









