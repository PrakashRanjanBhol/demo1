PrimeNG 16 OverlayPanel Integration - Modified Parts Only
üîÑ Changes for PrimeNG 16 OverlayPanel
Using OverlayPanel instead of ContextMenu for file actions.

üìù FILE 1: repository-sidebar.component.ts
MODIFY: Import Section (Lines 1-3)
typescript// ‚úÖ REPLACE/UPDATE IMPORTS
import { Component, OnInit, ViewChild } from '@angular/core';
import { OverlayPanel } from 'primeng/overlaypanel';
MODIFY: Properties Section (Lines ~120-123)
typescript// ‚úÖ ADD THESE PROPERTIES
// PrimeNG OverlayPanel
@ViewChild('op') overlayPanel!: OverlayPanel;
selectedFileName: string | null = null;
MODIFY: File Right Click Handler (Lines ~250-260)
typescript// ‚úÖ ADD THIS NEW METHOD (replaces handleFileRightClick)
onFileRightClick(event: MouseEvent, fileName: string): void {
  this.selectedFileName = fileName;
  if (this.overlayPanel) {
    this.overlayPanel.toggle(event);
  }
  event.preventDefault();
  event.stopPropagation();
}
MODIFY: Context Menu Actions (Lines ~260-285)
typescript// ‚úÖ UPDATE summarizeFile METHOD
summarizeFile(): void {
  if (this.selectedFileName) {
    const relativePath = [...this.currentPath.slice(1), this.selectedFileName].join('/');
    alert('Summarizing file: ' + relativePath);
  }
  this.selectedFileName = null;
  this.overlayPanel.hide();
}

// ‚úÖ ADD THIS NEW METHOD
openFile(): void {
  if (this.selectedFileName) {
    const relativePath = [...this.currentPath.slice(1), this.selectedFileName].join('/');
    alert('Opening file: ' + relativePath);
  }
  this.selectedFileName = null;
  this.overlayPanel.hide();
}

// ‚úÖ ADD THIS NEW METHOD
copyFilePath(): void {
  if (this.selectedFileName) {
    const relativePath = [...this.currentPath.slice(1), this.selectedFileName].join('/');
    navigator.clipboard.writeText(relativePath).then(() => {
      alert('Path copied to clipboard: ' + relativePath);
    });
  }
  this.selectedFileName = null;
  this.overlayPanel.hide();
}
‚ùå REMOVE THESE METHODS AND HOST LISTENERS:
typescript// ‚ùå REMOVE THESE (~30 lines around line 250-280)
handleFileRightClick(event: MouseEvent, fileName: string): void {
  event.preventDefault();
  event.stopPropagation();
  this.contextMenuFileName = fileName;
  this.contextMenuVisible = true;
  this.contextMenuX = event.pageX;
  this.contextMenuY = event.pageY;
}

hideContextMenu(): void {
  this.contextMenuVisible = false;
  this.contextMenuFileName = null;
}

@HostListener('document:click')
onDocumentClick(): void {
  this.hideContextMenu();
}

@HostListener('document:contextmenu', ['$event'])
onDocumentRightClick(event: MouseEvent): void {
  if ((event.target as HTMLElement).closest('.sidebar')) {
    if (!(event.target as HTMLElement).closest('.file-item')) {
      event.preventDefault();
    }
  }
}
‚ùå REMOVE THESE PROPERTIES:
typescript// ‚ùå REMOVE THESE (around line 120)
contextMenuVisible: boolean = false;
contextMenuX: number = 0;
contextMenuY: number = 0;
contextMenuFileName: string | null = null;

üìù FILE 2: repository-sidebar.component.html
MODIFY: File Item Event Handler (Line ~180)
html<!-- ‚ùå REMOVE THIS LINE -->
(contextmenu)="!item.isFolder && handleFileRightClick($event, item.name)">

<!-- ‚úÖ REPLACE WITH THIS LINE -->
(contextmenu)="!item.isFolder && onFileRightClick($event, item.name)">
MODIFY: Bottom of File (After closing </div> of sidebar)
html<!-- ‚ùå REMOVE THIS ENTIRE SECTION -->
<!-- Context Menu -->
<div class="context-menu" 
     [style.display]="contextMenuVisible ? 'block' : 'none'"
     [style.left.px]="contextMenuX"
     [style.top.px]="contextMenuY">
    <div class="context-menu-item" (click)="summarizeFile()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        Summarize File
    </div>
</div>

<!-- ‚úÖ ADD THIS SECTION AT THE VERY BOTTOM (after </div> of sidebar) -->
<p-overlayPanel #op [showCloseIcon]="false" [dismissable]="true" styleClass="file-actions-overlay">
    <ng-template pTemplate="content">
        <div class="overlay-menu">
            <div class="overlay-menu-item" (click)="summarizeFile()">
                <i class="pi pi-file"></i>
                <span>Summarize File</span>
            </div>
            <div class="overlay-menu-item" (click)="openFile()">
                <i class="pi pi-external-link"></i>
                <span>Open File</span>
            </div>
            <div class="overlay-menu-separator"></div>
            <div class="overlay-menu-item" (click)="copyFilePath()">
                <i class="pi pi-copy"></i>
                <span>Copy Path</span>
            </div>
        </div>
    </ng-template>
</p-overlayPanel>

üìù FILE 3: repository-sidebar.module.ts
MODIFY: Import Section and NgModule
typescriptimport { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { RepositorySidebarComponent } from './repository-sidebar.component';

// ‚úÖ ADD THIS IMPORT FOR PRIMENG 16
import { OverlayPanelModule } from 'primeng/overlaypanel';

@NgModule({
  declarations: [
    RepositorySidebarComponent
  ],
  imports: [
    CommonModule,
    FormsModule,
    OverlayPanelModule  // ‚úÖ ADD THIS LINE
  ],
  exports: [
    RepositorySidebarComponent
  ]
})
export class RepositorySidebarModule { }

üìù FILE 4: repository-sidebar.component.css
MODIFY: Bottom of File (Add these styles)
css/* ‚úÖ ADD THESE STYLES AT THE BOTTOM OF THE FILE */

/* ========================================
   PrimeNG 16 OverlayPanel Custom Styles
   ======================================== */

/* OverlayPanel Container */
::ng-deep .file-actions-overlay.p-overlaypanel {
    background-color: var(--bitbucket-bg-tertiary) !important;
    border: 1px solid var(--bitbucket-border-primary) !important;
    border-radius: 6px !important;
    box-shadow: 0 4px 12px var(--bitbucket-shadow-low) !important;
    padding: 0 !important;
    min-width: 180px;
}

/* OverlayPanel Content */
::ng-deep .file-actions-overlay .p-overlaypanel-content {
    padding: 4px 0 !important;
    background-color: var(--bitbucket-bg-tertiary) !important;
    border-radius: 6px !important;
}

/* Menu Container */
.overlay-menu {
    display: flex;
    flex-direction: column;
}

/* Menu Items */
.overlay-menu-item {
    padding: 10px 16px;
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    transition: background-color 0.2s ease;
    color: var(--bitbucket-text-primary);
    font-size: 13px;
}

.overlay-menu-item:hover {
    background-color: var(--bitbucket-border-primary);
}

.overlay-menu-item i {
    color: var(--bitbucket-text-secondary);
    font-size: 14px;
    width: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.overlay-menu-item span {
    color: var(--bitbucket-text-primary);
}

/* Menu Separator */
.overlay-menu-separator {
    border-top: 1px solid var(--bitbucket-border-primary);
    margin: 4px 0;
}

/* Light Mode Adjustments */
[data-theme="light"] ::ng-deep .file-actions-overlay.p-overlaypanel {
    background-color: var(--bitbucket-bg-tertiary) !important;
    border-color: var(--bitbucket-border-primary) !important;
    box-shadow: 0 4px 12px var(--bitbucket-shadow-low) !important;
}

[data-theme="light"] ::ng-deep .file-actions-overlay .p-overlaypanel-content {
    background-color: var(--bitbucket-bg-tertiary) !important;
}

[data-theme="light"] .overlay-menu-item:hover {
    background-color: var(--bitbucket-bg-hover) !important;
}

[data-theme="light"] .overlay-menu-item i {
    color: var(--bitbucket-text-secondary) !important;
}

[data-theme="light"] .overlay-menu-item span {
    color: var(--bitbucket-text-primary) !important;
}

/* Arrow/Pointer styling */
::ng-deep .file-actions-overlay .p-overlaypanel:before,
::ng-deep .file-actions-overlay .p-overlaypanel:after {
    border-color: transparent transparent var(--bitbucket-border-primary) transparent !important;
}

::ng-deep .file-actions-overlay .p-overlaypanel:after {
    border-color: transparent transparent var(--bitbucket-bg-tertiary) transparent !important;
}
‚ùå REMOVE THESE CSS RULES:
css/* ‚ùå REMOVE THESE ENTIRE SECTIONS (around line 380-420) */

/* Context Menu */
.context-menu {
    position: fixed;
    background-color: var(--bitbucket-bg-tertiary);
    border: 1px solid var(--bitbucket-border-primary);
    border-radius: 6px;
    padding: 4px 0;
    min-width: 160px;
    box-shadow: 0 4px 12px var(--bitbucket-shadow-low);
    z-index: 1000;
}

.context-menu-item {
    padding: 10px 16px;
    font-size: 13px;
    color: var(--bitbucket-text-primary);
    cursor: pointer;
    transition: background-color 0.2s ease;
    display: flex;
    align-items: center;
    gap: 10px;
}

.context-menu-item:hover {
    background-color: var(--bitbucket-border-primary);
}

.context-menu-item svg {
    width: 16px;
    height: 16px;
    color: var(--bitbucket-text-secondary);
}
