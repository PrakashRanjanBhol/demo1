import { Injectable } from '@angular/core';
import { BehaviorSubject } from 'rxjs';

export type ToastType = 'success' | 'error' | 'warning' | 'info';

export interface Toast {
  id: string;
  type: ToastType;
  title: string;
  message?: string;
  duration?: number; // ms, 0 = persist until dismissed
}

@Injectable({ providedIn: 'root' })
export class ToastService {
  private toasts$ = new BehaviorSubject<Toast[]>([]);
  readonly toasts = this.toasts$.asObservable();

  private add(toast: Omit<Toast, 'id'>): void {
    const id = crypto.randomUUID();
    const newToast: Toast = { id, duration: 4000, ...toast };

    this.toasts$.next([...this.toasts$.getValue(), newToast]);

    if (newToast.duration && newToast.duration > 0) {
      setTimeout(() => this.dismiss(id), newToast.duration);
    }
  }

  success(title: string, message?: string, duration?: number): void {
    this.add({ type: 'success', title, message, duration });
  }

  error(title: string, message?: string, duration?: number): void {
    this.add({ type: 'error', title, message, duration: duration ?? 0 }); // errors persist by default
  }

  warning(title: string, message?: string, duration?: number): void {
    this.add({ type: 'warning', title, message, duration: duration ?? 6000 });
  }

  info(title: string, message?: string, duration?: number): void {
    this.add({ type: 'info', title, message, duration });
  }

  dismiss(id: string): void {
    this.toasts$.next(this.toasts$.getValue().filter(t => t.id !== id));
  }

  clear(): void {
    this.toasts$.next([]);
  }
}









import {
  Component,
  OnInit,
  OnDestroy,
  ChangeDetectionStrategy,
  ChangeDetectorRef,
} from '@angular/core';
import { CommonModule } from '@angular/common';
import { Subscription } from 'rxjs';
import { Toast, ToastService } from './toast.service';

@Component({
  selector: 'app-toast-container',
  standalone: true,
  imports: [CommonModule],
  changeDetection: ChangeDetectionStrategy.OnPush,
  template: `
    <div class="toast-container" aria-live="polite" aria-atomic="false">
      <div
        *ngFor="let toast of toasts; trackBy: trackById"
        class="toast toast--{{ toast.type }}"
        [class.toast--entering]="true"
        role="alert"
      >
        <span class="toast__icon" [innerHTML]="icons[toast.type]"></span>
        <div class="toast__body">
          <p class="toast__title">{{ toast.title }}</p>
          <p *ngIf="toast.message" class="toast__message">{{ toast.message }}</p>
        </div>
        <button
          class="toast__close"
          (click)="dismiss(toast.id)"
          aria-label="Dismiss notification"
        >
          <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
        <div
          *ngIf="toast.duration && toast.duration > 0"
          class="toast__progress"
          [style.animation-duration.ms]="toast.duration"
        ></div>
      </div>
    </div>
  `,
  styles: [`
    :host {
      --toast-success: #16a34a;
      --toast-success-bg: #f0fdf4;
      --toast-success-border: #bbf7d0;

      --toast-error: #dc2626;
      --toast-error-bg: #fef2f2;
      --toast-error-border: #fecaca;

      --toast-warning: #d97706;
      --toast-warning-bg: #fffbeb;
      --toast-warning-border: #fde68a;

      --toast-info: #2563eb;
      --toast-info-bg: #eff6ff;
      --toast-info-border: #bfdbfe;

      font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
    }

    .toast-container {
      position: fixed;
      top: 1.25rem;
      right: 1.25rem;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 0.625rem;
      width: 360px;
      max-width: calc(100vw - 2.5rem);
      pointer-events: none;
    }

    .toast {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: start;
      gap: 0.75rem;
      padding: 0.875rem 1rem;
      border-radius: 10px;
      border: 1px solid transparent;
      box-shadow:
        0 4px 6px -1px rgb(0 0 0 / 0.08),
        0 2px 4px -2px rgb(0 0 0 / 0.06);
      pointer-events: all;
      position: relative;
      overflow: hidden;
      animation: slideIn 0.25s cubic-bezier(0.16, 1, 0.3, 1) both;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(calc(100% + 1.5rem));
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .toast--success {
      background: var(--toast-success-bg);
      border-color: var(--toast-success-border);
      color: #14532d;
    }
    .toast--error {
      background: var(--toast-error-bg);
      border-color: var(--toast-error-border);
      color: #7f1d1d;
    }
    .toast--warning {
      background: var(--toast-warning-bg);
      border-color: var(--toast-warning-border);
      color: #78350f;
    }
    .toast--info {
      background: var(--toast-info-bg);
      border-color: var(--toast-info-border);
      color: #1e3a8a;
    }

    .toast__icon {
      display: flex;
      align-items: center;
      margin-top: 1px;
      flex-shrink: 0;
    }
    .toast--success .toast__icon { color: var(--toast-success); }
    .toast--error   .toast__icon { color: var(--toast-error);   }
    .toast--warning .toast__icon { color: var(--toast-warning); }
    .toast--info    .toast__icon { color: var(--toast-info);    }

    .toast__body { min-width: 0; }

    .toast__title {
      margin: 0;
      font-size: 0.875rem;
      font-weight: 600;
      line-height: 1.4;
    }

    .toast__message {
      margin: 0.2rem 0 0;
      font-size: 0.8125rem;
      line-height: 1.5;
      opacity: 0.85;
    }

    .toast__close {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      border: none;
      background: transparent;
      cursor: pointer;
      border-radius: 4px;
      color: inherit;
      opacity: 0.5;
      transition: opacity 0.15s, background 0.15s;
      padding: 0;
      flex-shrink: 0;
      margin-top: 1px;
    }
    .toast__close:hover { opacity: 1; background: rgb(0 0 0 / 0.07); }

    .toast__progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 3px;
      width: 100%;
      transform-origin: left;
      animation: shrink linear forwards;
    }
    .toast--success .toast__progress { background: var(--toast-success); }
    .toast--error   .toast__progress { background: var(--toast-error);   }
    .toast--warning .toast__progress { background: var(--toast-warning); }
    .toast--info    .toast__progress { background: var(--toast-info);    }

    @keyframes shrink {
      from { transform: scaleX(1); }
      to   { transform: scaleX(0); }
    }
  `],
})
export class ToastContainerComponent implements OnInit, OnDestroy {
  toasts: Toast[] = [];
  private sub!: Subscription;

  readonly icons: Record<string, string> = {
    success: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`,
    error:   `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>`,
    warning: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>`,
    info:    `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>`,
  };

  constructor(private toastService: ToastService, private cdr: ChangeDetectorRef) {}

  ngOnInit(): void {
    this.sub = this.toastService.toasts.subscribe(toasts => {
      this.toasts = toasts;
      this.cdr.markForCheck();
    });
  }

  ngOnDestroy(): void {
    this.sub.unsubscribe();
  }

  dismiss(id: string): void {
    this.toastService.dismiss(id);
  }

  trackById(_: number, toast: Toast): string {
    return toast.id;
  }
}











import { Component } from '@angular/core';
import { ToastService } from './toast.service';
import { ToastContainerComponent } from './toast-container.component';

@Component({
  selector: 'app-root',
  standalone: true,
  imports: [ToastContainerComponent],
  template: `
    <!-- Place this ONCE in your root AppComponent template -->
    <app-toast-container />

    <!-- Demo buttons -->
    <div style="display:flex;gap:0.75rem;padding:2rem;flex-wrap:wrap">
      <button (click)="showSuccess()">✅ Success</button>
      <button (click)="showError()">❌ Error</button>
      <button (click)="showWarning()">⚠️ Warning</button>
      <button (click)="showInfo()">ℹ️ Info</button>
      <button (click)="showAll()">Show All</button>
      <button (click)="toastService.clear()">Clear All</button>
    </div>
  `,
})
export class AppComponent {
  constructor(public toastService: ToastService) {}

  showSuccess() {
    this.toastService.success('Changes saved', 'Your profile has been updated successfully.');
  }

  showError() {
    this.toastService.error('Upload failed', 'The file exceeds the 5 MB size limit.');
  }

  showWarning() {
    this.toastService.warning('Session expiring', 'You will be logged out in 5 minutes.');
  }

  showInfo() {
    this.toastService.info('Tip', 'You can drag and drop files directly into the editor.');
  }

  showAll() {
    this.showSuccess();
    this.showError();
    this.showWarning();
    this.showInfo();
  }
}
