// ✅ ADD: Cache properties
private _cachedRepositories: Repository[] = [];
private _lastProjectKey: string = '';
private _favoriteRepoKeys: Set<string> = new Set();
private _projectRepoCounts: { [key: string]: number } = {};




// ✅ REPLACE getRepositoriesForProject() with this getter
get currentRepositories(): Repository[] {
  const projectKey = this.currentProject?.project_key || '';
  
  if (this._lastProjectKey !== projectKey) {
    this._lastProjectKey = projectKey;
    this._cachedRepositories = this.repositoriesByProject[projectKey] || [];
  }
  
  return this._cachedRepositories;
}

// ✅ ADD: Displayed repos with search filter
get displayedRepositories(): Repository[] {
  if (!this.repoSearchText.trim()) {
    return this.currentRepositories;
  }
  
  const searchLower = this.repoSearchText.toLowerCase();
  return this.currentRepositories.filter(repo => 
    repo.repo_name.toLowerCase().includes(searchLower) ||
    repo.repo_url.toLowerCase().includes(searchLower)
  );
}

// ✅ REPLACE isFavorite() with Set-based check
isFavoriteRepo(repoKey: string): boolean {
  return this._favoriteRepoKeys.has(repoKey);
}

// ✅ REPLACE getProjectRepoCount() with cached version
getRepoCount(projectKey: string): number {
  return this._projectRepoCounts[projectKey] || 0;
}












// ✅ ADD: Build favorites cache
private updateFavoriteKeysCache(): void {
  this._favoriteRepoKeys = new Set(
    this.favoriteRepositories.map(repo => repo.repo_key)
  );
}

// ✅ ADD: Build repo counts cache
private updateProjectRepoCountsCache(): void {
  this._projectRepoCounts = {};
  for (const projectKey in this.repositoriesByProject) {
    this._projectRepoCounts[projectKey] = this.repositoriesByProject[projectKey].length;
  }
}










ngOnInit(): void {
  this.loadProjects();
  this.loadFavorites();
  
  // ✅ ADD: Build caches on init
  this.updateFavoriteKeysCache();
  this.updateProjectRepoCountsCache();
}










toggleFavorite(repoKey: string, projectKey: string, event: Event): void {
  event.stopPropagation();
  this.loadingRepos[repoKey] = true;

  setTimeout(() => {
    const index = this.favoriteRepositories.findIndex(r => r.repo_key === repoKey);
    
    if (index > -1) {
      this.favoriteRepositories.splice(index, 1);
    } else {
      const repos = this.repositoriesByProject[projectKey] || [];
      const repo = repos.find(r => r.repo_key === repoKey);
      if (repo) {
        this.favoriteRepositories.push(repo);
      }
    }
    
    this.updateFavoriteKeysCache(); // ✅ ADD: Refresh cache
    this.loadingRepos[repoKey] = false;
  }, 500);
}














<!-- ✅ CHANGE FROM: -->
{{ getProjectRepoCount(project.project_key) }} repositories

<!-- ✅ CHANGE TO: -->
{{ getRepoCount(project.project_key) }} repositories







<!-- ✅ CHANGE FROM: -->
*ngFor="let repo of getRepositoriesForProject(currentProject?.project_key || '')"

<!-- ✅ CHANGE TO: -->
*ngFor="let repo of displayedRepositories; trackBy: trackByRepoKey"








<!-- ✅ CHANGE FROM: -->
[class.favorited]="isFavorite(repo.repo_key)"

<!-- ✅ CHANGE TO: -->
[class.favorited]="isFavoriteRepo(repo.repo_key)"



