constructor(
  private http: HttpClient,
  private router: Router
) {
  // Don't check localStorage - always start with null
  this.currentUserSubject = new BehaviorSubject<User | null>(null);
  this.currentUser = this.currentUserSubject.asObservable();
}






constructor(
  private authService: AuthService,
  private router: Router
) {}

ngOnInit(): void {
  // Always attempt SSO login on page load/refresh
  this.attemptAutoSSO();

  // Load saved theme from localStorage
  const savedTheme = localStorage.getItem('theme') as 'light' | 'dark';
  if (savedTheme) {
    this.currentTheme = savedTheme;
    this.applyTheme(savedTheme);
  }

  // Load sidebar state from localStorage
  const savedSidebarState = localStorage.getItem('sidebarCollapsed');
  if (savedSidebarState !== null) {
    this.isSidebarCollapsed = savedSidebarState === 'true';
  }

  // Subscribe to current user changes AFTER SSO attempt starts
  this.authService.currentUser.subscribe(user => {
    this.currentUser = user;
    this.isAuthenticated = user !== null;
  });
}
