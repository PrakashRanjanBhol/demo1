lineTexts.forEach(lineText => {
  if (part.added) {
    const comment = this.findCommentForLine(file, newLineNum, 'TO');
    lines.push({
      type: 'added',
      newLineNum,
      content: this.highlightSyntax(lineText, file.file_path),
      comment
    });
    newLineNum++;
  } else if (part.removed) {
    const comment = this.findCommentForLine(file, oldLineNum, 'FROM');
    lines.push({
      type: 'deleted',
      oldLineNum,
      content: this.highlightSyntax(lineText, file.file_path),
      comment
    });
    oldLineNum++;
  } else {
    // Changed: Check for comments on context lines too
    const commentFrom = this.findCommentForLine(file, oldLineNum, 'FROM');
    const commentTo = this.findCommentForLine(file, newLineNum, 'TO');
    const comment = commentTo || commentFrom; // Prioritize TO comments
    
    lines.push({
      type: 'context',
      oldLineNum,
      newLineNum,
      content: this.highlightSyntax(lineText, file.file_path),
      comment
    });
    oldLineNum++;
    newLineNum++;
  }
});
