// Add this method to remove duplicate comments
private deduplicateComments(file: DiffFile): DiffFile {
  const seenComments = new Map<string, AIComment>();
  const uniqueComments: AIComment[] = [];

  file.ai_comments.forEach(comment => {
    // Create a unique key based on line number and side
    const key = `${comment.line}-${comment.side}`;
    
    // Only keep the first comment for each line-side combination
    if (!seenComments.has(key)) {
      seenComments.set(key, comment);
      uniqueComments.push(comment);
    }
  });

  return {
    ...file,
    ai_comments: uniqueComments
  };
}

// Update loadMockData to deduplicate comments
private loadMockData(): void {
  this.files = [
    {
      file_path: "src/app/services/auth.service.ts",
      old_lines: [
        // ... your existing old_lines
      ],
      new_lines: [
        // ... your existing new_lines
      ],
      ai_comments: [
        // ... your existing ai_comments
      ]
    },
    // ... other files
  ];

  // Deduplicate comments for all files
  this.files = this.files.map(file => this.deduplicateComments(file));
}

// Alternative: If you're loading files from an API, deduplicate there
loadFilesFromAPI(files: DiffFile[]): void {
  this.files = files.map(file => this.deduplicateComments(file));
  this.sortFilesByComments();
  if (this.files.length > 0) {
    this.onFileSelect(0);
  }
}

// Update onFileSelect to ensure deduplication when selecting
onFileSelect(index: number): void {
  if (index >= 0 && index < this.files.length) {
    this.selectedFileIndex = index;
    // Deduplicate before setting selected file
    this.selectedFile = this.deduplicateComments(this.files[index]);
    this.renderDiff();
  }
}
