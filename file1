private parseObject(obj: string): ToolCommand | null {
  try {
    let jsonStr = obj.trim();
    
    // Aggressive sanitization - removes all control characters
    jsonStr = this.aggressiveSanitize(jsonStr);
    
    jsonStr = this.quotePropertyNames(jsonStr);
    jsonStr = this.normalizeQuotes(jsonStr);
    
    // Additional safety: remove any trailing commas
    jsonStr = jsonStr.replace(/,(\s*[}\]])/g, '$1');
    
    const parsed = JSON.parse(jsonStr);

    if (typeof parsed !== 'object' || !parsed.tool) {
      console.warn('Invalid tool command structure:', parsed);
      return null;
    }

    return parsed as ToolCommand;

  } catch (error) {
    console.error('Parse object error:', error);
    console.error('Problematic string:', obj);
    throw error;
  }
}

// Aggressive sanitization - removes all problematic characters
private aggressiveSanitize(str: string): string {
  return str
    // Remove all control characters except \n, \r, \t
    .replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g, '')
    // Normalize line breaks
    .replace(/\r\n/g, '\n')
    // Remove zero-width spaces and other invisible characters
    .replace(/[\u200B-\u200D\uFEFF]/g, '');
}
