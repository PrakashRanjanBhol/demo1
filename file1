import { Injectable } from '@angular/core';

@Injectable({
  providedIn: 'root'
})
export class JsonToMarkdownService {

  constructor() { }

  jsonToMarkdown(jsonString: string): string {
    try {
      const data = JSON.parse(jsonString);
      return this.objectToMarkdown(data);
    } catch (error) {
      return `Error parsing JSON: ${(error as Error).message}`;
    }
  }

  private objectToMarkdown(obj: any, level: number = 1): string {
    let markdown = '';

    if (Array.isArray(obj)) {
      obj.forEach((item) => {
        if (typeof item === 'object' && item !== null) {
          markdown += this.objectToMarkdown(item, level);
        } else {
          markdown += `- ${item}\n`;
        }
      });
    } else if (typeof obj === 'object' && obj !== null) {
      for (const [key, value] of Object.entries(obj)) {
        const heading = '#'.repeat(Math.min(level, 6));
        markdown += `${heading} ${key}\n\n`;

        if (Array.isArray(value)) {
          markdown += this.objectToMarkdown(value, level + 1);
        } else if (typeof value === 'object' && value !== null) {
          markdown += this.objectToMarkdown(value, level + 1);
        } else {
          markdown += `${value}\n\n`;
        }
      }
    } else {
      markdown += `${obj}\n\n`;
    }

    return markdown;
  }
}
