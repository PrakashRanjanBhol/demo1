@Output() allFilesReviewed = new EventEmitter<void>();


acceptFile(index: number): void {
    this.loadingFiles.add(index);
    this.fileActions.set(index, 'accepting');
    
    setTimeout(() => {
      console.log(`File ${index} accepted:`, this.files[index].file_name);
      console.log('File path:', this.files[index].file_path);
      console.log('Applied code:', this.files[index].modified_code);
      
      this.acceptedFiles.add(index);
      this.loadingFiles.delete(index);
      this.fileActions.delete(index);
      this.onFileAccepted.emit({ file: this.files[index], index });
      
      // Check if all files are reviewed
      this.checkAndEmitAllFilesReviewed();
    }, 1500);
  }







rejectFile(index: number): void {
    this.loadingFiles.add(index);
    this.fileActions.set(index, 'rejecting');
    
    setTimeout(() => {
      console.log(`File ${index} rejected:`, this.files[index].file_name);
      console.log('File path:', this.files[index].file_path);
      console.log('Keeping original code:', this.files[index].original_code);
      
      this.rejectedFiles.add(index);
      this.loadingFiles.delete(index);
      this.fileActions.delete(index);
      this.onFileRejected.emit({ file: this.files[index], index });
      
      // Check if all files are reviewed
      this.checkAndEmitAllFilesReviewed();
    }, 1500);
  }








acceptAll(): void {
    this.isApproveAllLoading = true;
    
    console.log('All files accepted');
    console.log('Tool:', this.toolType);
    console.log('Reasoning:', this.reasoning);
    
    const acceptPromises = this.files.map((file, index) => {
      return new Promise<void>((resolve) => {
        this.loadingFiles.add(index);
        
        setTimeout(() => {
          console.log(`${file.file_name} (${file.file_path}): Applied code`, file.modified_code);
          this.acceptedFiles.add(index);
          this.loadingFiles.delete(index);
          resolve();
        }, 1500);
      });
    });
    
    Promise.all(acceptPromises).then(() => {
      this.isApproveAllLoading = false;
      this.onAcceptAll.emit();
      
      // Emit all files reviewed and close
      this.allFilesReviewed.emit();
    });
  }











rejectAll(): void {
    this.isRejectAllLoading = true;
    
    console.log('All files rejected');
    console.log('Tool:', this.toolType);
    console.log('Reasoning:', this.reasoning);
    
    const rejectPromises = this.files.map((file, index) => {
      return new Promise<void>((resolve) => {
        this.loadingFiles.add(index);
        
        setTimeout(() => {
          console.log(`${file.file_name} (${file.file_path}): Keeping original code`, file.original_code);
          this.rejectedFiles.add(index);
          this.loadingFiles.delete(index);
          resolve();
        }, 1500);
      });
    });
    
    Promise.all(rejectPromises).then(() => {
      this.isRejectAllLoading = false;
      this.onRejectAll.emit();
      
      // Emit all files reviewed and close
      this.allFilesReviewed.emit();
    });
  }








private checkAndEmitAllFilesReviewed(): void {
    // Check if all files have been reviewed (either accepted or rejected)
    if (this.allFilesProcessed()) {
      // Small delay to show the final state before closing
      setTimeout(() => {
        this.allFilesReviewed.emit();
      }, 500);
    }
  }











<app-diff-viewer 
  [config]="config"
  (onAcceptAll)="handleAcceptAll()"
  (onRejectAll)="handleRejectAll()"
  (onFileAccepted)="handleFileAccepted($event)"
  (onFileRejected)="handleFileRejected($event)"
  (allFilesReviewed)="closeModal()">
</app-diff-viewer>






<app-diff-viewer-modal
  [isOpen]="isModalOpen"
  [config]="fileConfig"
  [isLoadingConfig]="isLoadingConfig"
  (close)="closeModal()"
  (allFilesReviewed)="handleAllFilesReviewed()">
</app-diff-viewer-modal>







handleAllFilesReviewed(): void {
  console.log('All files have been reviewed!');
  // Auto-close modal
  this.closeModal();
}
