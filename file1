// Add this property to your component class
selectedFileIndex: number = 0;

// Add this method to select a file
selectFile(index: number): void {
  this.selectedFileIndex = index;
  
  // Re-render the selected file
  setTimeout(() => {
    this.renderDiff(this.responseData.files[index], index);
    setTimeout(() => {
      this.highlightCommentedLines(this.responseData.files[index], index);
      this.insertCommentsAtLines(this.responseData.files[index], index);
    }, 200);
  }, 50);
}

// Update renderAllDiffs to only render the selected file
renderAllDiffs(): void {
  if (this.responseData.files.length > 0) {
    this.renderDiff(this.responseData.files[this.selectedFileIndex], this.selectedFileIndex);
    setTimeout(() => {
      this.highlightCommentedLines(this.responseData.files[this.selectedFileIndex], this.selectedFileIndex);
    }, 200);
  }
}

// Update toggleViewMode to re-render only the selected file
toggleViewMode(): void {
  this.viewMode = this.viewMode === 'side-by-side' ? 'line-by-line' : 'side-by-side';
  setTimeout(() => {
    this.renderDiff(this.responseData.files[this.selectedFileIndex], this.selectedFileIndex);
    setTimeout(() => {
      this.highlightCommentedLines(this.responseData.files[this.selectedFileIndex], this.selectedFileIndex);
      this.insertCommentsAtLines(this.responseData.files[this.selectedFileIndex], this.selectedFileIndex);
    }, 300);
  }, 50);
}












<div class="pr-review-container">
    <div class="container">
        <!-- Compact Toggle Header -->
        <div class="compact-header">
            <h2 class="review-title">AI Review</h2>
            <div class="view-toggle-switch">
                <input type="checkbox" id="viewToggle" [checked]="viewMode === 'side-by-side'" 
                       (change)="toggleViewMode()" class="toggle-input">
                <label for="viewToggle" class="toggle-label">
                    <span class="toggle-slider">
                        <span class="toggle-option unified">Unified</span>
                        <span class="toggle-option split">Split</span>
                    </span>
                </label>
            </div>
        </div>

        <!-- File Navigation Tabs -->
        <div class="file-navigation">
            <div class="file-tabs">
                <button 
                    *ngFor="let file of responseData.files; let i = index"
                    class="file-tab"
                    [class.active]="selectedFileIndex === i"
                    (click)="selectFile(i)"
                    [title]="file.file_path">
                    <span class="file-icon">ðŸ“„</span>
                    <span class="file-name">{{ getFileName(file.file_path) }}</span>
                    <span class="file-comment-badge" *ngIf="file.ai_comments.length > 0">
                        {{ file.ai_comments.length }}
                    </span>
                </button>
            </div>
        </div>

        <!-- Single File Container -->
        <div id="files-container">
            <div class="file-section" *ngIf="responseData.files[selectedFileIndex]">
                <!-- File Header -->
                <div class="file-header">
                    <span class="file-icon">ðŸ“„</span>
                    <span>{{ responseData.files[selectedFileIndex].file_path }}</span>
                    <span class="ai-comment-count" *ngIf="responseData.files[selectedFileIndex].ai_comments.length > 0">
                        {{ responseData.files[selectedFileIndex].ai_comments.length }} AI 
                        {{ responseData.files[selectedFileIndex].ai_comments.length === 1 ? 'comment' : 'comments' }}
                    </span>
                    <div class="file-stats">
                        <span class="stat-additions">+{{ getFileStats(responseData.files[selectedFileIndex]).additions }}</span>
                        <span class="stat-deletions">-{{ getFileStats(responseData.files[selectedFileIndex]).deletions }}</span>
                    </div>
                </div>

                <!-- Diff Container -->
                <div class="diff-container">
                    <div [id]="'diff-output-' + selectedFileIndex"></div>

                    <!-- AI Comments (hidden, will be moved to appropriate lines) -->
                    <div class="comments-hidden-container">
                        <div class="ai-comment-thread" 
                            *ngFor="let comment of responseData.files[selectedFileIndex].ai_comments; let commentIndex = index"
                            [attr.data-line]="comment.line" 
                            [id]="'comment-' + getCommentId(selectedFileIndex, commentIndex)">

                            <div [class]="getCommentClasses(selectedFileIndex, commentIndex)"
                                [id]="getCommentId(selectedFileIndex, commentIndex)">

                                <!-- Comment Header -->
                                <div class="comment-header">
                                    <span class="ai-badge">AI Review</span>
                                    <span class="severity-badge" [ngClass]="'severity-' + comment.severity">
                                        {{ comment.severity }}
                                    </span>

                                    <span *ngIf="getCommentState(selectedFileIndex, commentIndex).status !== 'pending'"
                                        class="status-badge"
                                        [ngClass]="'status-' + getCommentState(selectedFileIndex, commentIndex).status">
                                        {{ getCommentState(selectedFileIndex, commentIndex).status }}
                                    </span>

                                    <span class="comment-time">Line {{ comment.line }}</span>
                                </div>

                                <!-- Comment Body -->
                                <div *ngIf="!getCommentState(selectedFileIndex, commentIndex).isEditing" class="comment-body"
                                    [id]="getCommentId(selectedFileIndex, commentIndex) + '-body'">
                                    {{ getCommentState(selectedFileIndex, commentIndex).currentText }}
                                </div>

                                <!-- Edit Mode -->
                                <div *ngIf="getCommentState(selectedFileIndex, commentIndex).isEditing">
                                    <textarea class="comment-body-editable"
                                        [(ngModel)]="editingCommentText[getCommentId(selectedFileIndex, commentIndex)]"
                                        [id]="getCommentId(selectedFileIndex, commentIndex) + '-textarea'">
                                    </textarea>
                                </div>

                                <!-- Suggested Patch -->
                                <div class="suggested-patch" *ngIf="comment.suggested_patch">
                                    <div class="suggested-patch-header">Suggested Fix:</div>
                                    <div class="suggested-patch-code">{{ comment.suggested_patch }}</div>
                                </div>

                                <!-- Comment Actions -->
                                <div class="comment-actions" [id]="getCommentId(selectedFileIndex, commentIndex) + '-actions'">

                                    <!-- Pending State Actions -->
                                    <ng-container
                                        *ngIf="getCommentState(selectedFileIndex, commentIndex).status === 'pending' && !getCommentState(selectedFileIndex, commentIndex).isEditing">
                                        <button class="action-btn btn-accept"
                                            (click)="acceptComment(selectedFileIndex, commentIndex)">
                                            <span class="btn-icon">âœ“</span>
                                            <span class="btn-text">Accept</span>
                                        </button>
                                        <button class="action-btn btn-reject"
                                            (click)="rejectComment(selectedFileIndex, commentIndex)">
                                            <span class="btn-icon">âœ—</span>
                                            <span class="btn-text">Reject</span>
                                        </button>
                                        <button class="action-btn btn-modify"
                                            (click)="modifyComment(selectedFileIndex, commentIndex)">
                                            <span class="btn-icon">âœŽ</span>
                                            <span class="btn-text">Modify</span>
                                        </button>
                                    </ng-container>

                                    <!-- Editing State Actions -->
                                    <ng-container *ngIf="getCommentState(selectedFileIndex, commentIndex).isEditing">
                                        <button class="action-btn btn-save"
                                            (click)="saveModifiedComment(selectedFileIndex, commentIndex)">
                                            <span class="btn-icon">ðŸ’¾</span>
                                            <span class="btn-text">Save</span>
                                        </button>
                                        <button class="action-btn btn-cancel"
                                            (click)="cancelModification(selectedFileIndex, commentIndex)">
                                            <span class="btn-icon">âœ•</span>
                                            <span class="btn-text">Cancel</span>
                                        </button>
                                    </ng-container>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

















getFileName(filePath: string): string {
  const parts = filePath.split('/');
  return parts[parts.length - 1];
}






/* File Navigation Tabs */
.file-navigation {
    background: var(--bitbucket-file-comparator-bg-tertiary);
    border-bottom: 1px solid var(--bitbucket-file-comparator-border-primary);
    overflow-x: auto;
    overflow-y: hidden;
    white-space: nowrap;
}

.file-tabs {
    display: flex;
    gap: 4px;
    padding: 8px 16px;
    min-height: 48px;
}

.file-tab {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: var(--bitbucket-file-comparator-bg-primary);
    border: 2px solid var(--bitbucket-file-comparator-border-primary);
    border-bottom: none;
    border-radius: 8px 8px 0 0;
    font-size: 13px;
    font-weight: 500;
    color: var(--bitbucket-file-comparator-text-secondary);
    cursor: pointer;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    white-space: nowrap;
    max-width: 250px;
}

.file-tab:hover {
    background: var(--bitbucket-file-comparator-bg-overlay);
    border-color: var(--bitbucket-file-comparator-accent-primary);
    color: var(--bitbucket-file-comparator-text-primary);
    transform: translateY(-2px);
}

.file-tab.active {
    background: var(--bitbucket-file-comparator-bg-primary);
    border-color: var(--bitbucket-file-comparator-accent-primary);
    color: var(--bitbucket-file-comparator-accent-primary);
    font-weight: 600;
    box-shadow: 0 -2px 8px rgba(0, 82, 204, 0.15);
}

.file-tab.active::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--bitbucket-file-comparator-bg-primary);
}

.file-name {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.file-comment-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 20px;
    height: 20px;
    padding: 0 6px;
    background: var(--bitbucket-file-comparator-purple-bg);
    color: var(--bitbucket-file-comparator-purple-text);
    border-radius: 10px;
    font-size: 11px;
    font-weight: 700;
}

.file-tab.active .file-comment-badge {
    background: var(--bitbucket-file-comparator-accent-primary);
    color: white;
}

/* Scrollbar for file tabs */
.file-navigation::-webkit-scrollbar {
    height: 6px;
}

.file-navigation::-webkit-scrollbar-track {
    background: var(--bitbucket-file-comparator-bg-primary);
}

.file-navigation::-webkit-scrollbar-thumb {
    background: var(--bitbucket-file-comparator-border-secondary);
    border-radius: 3px;
}

.file-navigation::-webkit-scrollbar-thumb:hover {
    background: var(--bitbucket-file-comparator-text-secondary);
}
