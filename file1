// Add this property
private sortedFiles: DiffFile[] = [];

// Update ngOnInit to sort files
ngOnInit(): void {
  this.loadMockData();
  this.sortFilesByComments(); // Sort files after loading
  
  const savedTheme = localStorage.getItem('bitbucket-pr-review-theme');
  this.isDarkMode = savedTheme === 'dark';
  
  hljs.configure({
    ignoreUnescapedHTML: true,
    languages: ['typescript', 'javascript', 'python', 'java', 'csharp', 'cpp', 'go', 'rust', 'ruby', 'php', 'swift', 'kotlin', 'scala']
  });
}

// Add this method to sort files
private sortFilesByComments(): void {
  this.sortedFiles = [...this.files].sort((a, b) => {
    const aComments = a.ai_comments.length;
    const bComments = b.ai_comments.length;
    
    // Files with comments first
    if (aComments > 0 && bComments === 0) return -1;
    if (aComments === 0 && bComments > 0) return 1;
    
    // If both have comments, sort by comment count (descending)
    if (aComments > 0 && bComments > 0) {
      return bComments - aComments;
    }
    
    // If neither has comments, maintain original order
    return 0;
  });
}

// Update selectFileByIndex to work with sorted files
selectFileByIndex(index: number): void {
  const file = this.sortedFiles[index];
  const originalIndex = this.files.indexOf(file);
  this.onFileSelect(originalIndex);
  this.closeDropdown();
}

// Update getFileCommentsCount if needed (it's already fine)
getFileCommentsCount(file: DiffFile): number {
  return file.ai_comments.length;
}

// Update resetComponentState to clear sorted files
resetComponentState(): void {
  this.files = [];
  this.sortedFiles = [];
  this.selectedFile = null;
  this.selectedFileIndex = -1;
  this.diffLines = [];
  this.stats = null;
  
  this.editingComments.clear();
  this.commentStates.clear();
  this.processingComments.clear();
  
  this.clearCommentCache();
  
  this.currentView = 'unified';
  this.isDropdownOpen = false;
}

// Update loadMockData or any method that loads files
private loadMockData(): void {
  // ... your existing loadMockData code ...
  // After setting this.files, call:
  // this.sortFilesByComments(); (already called in ngOnInit)
}










<div class="file-selector">
  <div class="custom-dropdown" [class.open]="isDropdownOpen">
    <div class="dropdown-selected" (click)="toggleDropdown()">
      <div class="selected-content">
        <span class="file-icon">ðŸ“„</span>
        <span class="file-name">
          {{ selectedFile ? selectedFile.file_path : 'Select a file to view diff...' }}
        </span>
        <span class="comment-badge" *ngIf="selectedFile && getFileCommentsCount(selectedFile) > 0">
          {{ getFileCommentsCount(selectedFile) }}
        </span>
      </div>
      <svg class="dropdown-arrow" [class.rotated]="isDropdownOpen" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
      </svg>
    </div>
    
    <div class="dropdown-options" *ngIf="isDropdownOpen" (click)="$event.stopPropagation()">
      <div class="dropdown-list">
        <!-- Use sortedFiles instead of files -->
        <div 
          *ngFor="let file of sortedFiles; let i = index" 
          class="dropdown-option"
          [class.selected]="selectedFile === file"
          [class.has-comments]="getFileCommentsCount(file) > 0"
          (click)="selectFileByIndex(i)">
          <div class="option-content">
            <span class="file-icon">ðŸ“„</span>
            <span class="file-path">{{ file.file_path }}</span>
          </div>
          <span class="comment-badge" *ngIf="getFileCommentsCount(file) > 0">
            {{ getFileCommentsCount(file) }}
          </span>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Backdrop to close dropdown -->
  <div class="dropdown-backdrop" *ngIf="isDropdownOpen" (click)="closeDropdown()"></div>
</div>













.dropdown-option {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  cursor: pointer;
  transition: all 0.15s ease;
  border-bottom: 1px solid var(--bitbucket-pr-review-border-light);

  &:last-child {
    border-bottom: none;
  }

  &:hover {
    background-color: var(--bitbucket-pr-review-bg-hover);
  }

  &.selected {
    background-color: rgba(59, 130, 246, 0.1);
    border-left: 3px solid #3b82f6;

    .file-path {
      color: #3b82f6;
      font-weight: 600;
    }
  }

  // Add visual distinction for files with comments
  &.has-comments {
    position: relative;

    &::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: linear-gradient(180deg, rgba(59, 130, 246, 0.3) 0%, rgba(37, 99, 235, 0.1) 100%);
    }

    &:first-child {
      border-top: 2px solid rgba(59, 130, 246, 0.2);
    }
  }

  // Add separator after files with comments
  &.has-comments:not(:has(+ .has-comments)) {
    border-bottom: 2px solid rgba(59, 130, 246, 0.2);
    margin-bottom: 4px;
  }
}
