/**
 * Map API response to result items
 */
private mapResponseToResultItems(data: any): void {
  this.resultItems = [];
  this.hasNoData = false;

  // Check if summary is empty
  const hasSummary = data.summary && 
    typeof data.summary === 'string' && 
    data.summary.trim().length > 0;

  // Check if keywords is empty
  const hasKeywords = data.keywords && 
    Array.isArray(data.keywords) && 
    data.keywords.length > 0;

  // Check if faq is empty - handles "", "[]", [], null, undefined
  const isFaqEmpty = (faq: any): boolean => {
    if (!faq) return true;
    if (Array.isArray(faq) && faq.length === 0) return true;
    if (typeof faq === 'string') {
      const trimmed = faq.trim();
      if (trimmed === '') return true;
      if (trimmed === '[]') return true;
      // Try parsing the string to check if it's an empty array
      try {
        const parsed = JSON.parse(trimmed);
        if (Array.isArray(parsed) && parsed.length === 0) return true;
      } catch {
        // If parsing fails and it's not empty string or "[]", consider it non-empty
        return false;
      }
    }
    return false;
  };

  const hasFaq = !isFaqEmpty(data.faq);

  // If all are empty, set empty state
  if (!hasSummary && !hasKeywords && !hasFaq) {
    this.hasNoData = true;
    return;
  }

  // Add Summary with markdown rendering
  if (hasSummary) {
    const htmlContent: any = marked(data.summary);
    this.resultItems.push({
      id: 'summary-1',
      title: 'Summary',
      icon: 'document',
      content: data.summary,
      type: 'summary',
      htmlContent: this.sanitizer.bypassSecurityTrustHtml(htmlContent)
    });
  }

  // Add Keywords
  if (hasKeywords) {
    this.resultItems.push({
      id: 'keywords-1',
      title: 'Key Topics',
      icon: 'tag',
      content: data.keywords.map((k: string) => `â€¢ ${k}`).join(' '),
      type: 'keywords',
      keywords: data.keywords
    });
  }

  // Add Assessment Questions (FAQ as MCQ)
  if (hasFaq) {
    try {
      const parsedFaq = typeof data.faq === 'string' ? eval(data.faq) : data.faq;

      // Store raw FAQ data for copying
      this.faqRawData = data.faq;

      if (Array.isArray(parsedFaq) && parsedFaq.length > 0) {
        this.resultItems.push({
          id: 'assessment-1',
          title: 'Assessment Questions',
          icon: 'question',
          content: `${parsedFaq.length} questions`,
          type: 'questions',
          assessmentQuestions: parsedFaq
        });
      } else {
        // Parsed FAQ resulted in empty array
        if (!hasSummary && !hasKeywords) {
          this.hasNoData = true;
          return;
        }
      }
    } catch (error) {
      console.error('Error parsing FAQ:', error);
    }
  }

  // Final check - if resultItems is still empty, show no data state
  if (this.resultItems.length === 0) {
    this.hasNoData = true;
  }
}
