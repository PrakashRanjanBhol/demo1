copyAs(item: ResultItem, format: string): void {
  const content   = formatContentForExport(item, format as CopyFormat);
  const mimeType  = getMimeType(format as CopyFormat);
  const extension = getFileExtension(format as CopyFormat);
  const baseName  = this.selectedHistoryItem?.name
    ? this.selectedHistoryItem.name.replace(/\.[^/.]+$/, '')
    : 'export';
  const typeLabel = item.type === 'summary'  ? 'summary'
                  : item.type === 'keywords' ? 'keywords'
                  : 'assessment';
  const filename  = `${baseName}_${typeLabel}.${extension}`;

  downloadAsFile(content, filename, mimeType);

  // Show tick on copy button
  this.copiedItemId = item.id;
  setTimeout(() => { this.copiedItemId = ''; }, 1500);

  this.closeActionOptions();
}




export function getMimeType(format: CopyFormat | DownloadFormat): string {
  switch (format) {
    case 'json': return 'application/json';
    case 'html': return 'text/html';
    case 'md':   return 'text/markdown';
    case 'txt':  return 'text/plain';
    default:     return 'text/plain';
  }
}

export function getFileExtension(format: CopyFormat | DownloadFormat): string {
  switch (format) {
    case 'json': return 'json';
    case 'html': return 'html';
    case 'md':   return 'md';
    case 'txt':  return 'txt';
    default:     return 'txt';
  }
}
