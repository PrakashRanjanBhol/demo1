if (this.viewMode === 'side-by-side') {
  // In side-by-side mode, we need to find the correct side
  const lineNumberElements = row.querySelectorAll('.d2h-code-side-linenumber');
  
  Array.from(lineNumberElements).forEach((lineNumElement, index) => {
    if (commentInserted) return;
    
    const lineText = lineNumElement.textContent?.trim() || '';
    const lineNum = parseInt(lineText);

    // Check if this matches our comment line
    if (!isNaN(lineNum) && lineNum === comment.line) {
      // Determine which side this line number is on
      // In side-by-side, there are typically 2 line numbers per row
      // index 0 = left side (FROM/old), index 1 = right side (TO/new)
      const isLeftSide = index === 0;
      const isRightSide = index === 1;
      
      // Alternative: Check parent element classes
      const parentCell = lineNumElement.closest('td');
      const hasDeletedClass = parentCell?.classList.contains('d2h-del') || 
                             parentCell?.parentElement?.classList.contains('d2h-del');
      const hasInsertedClass = parentCell?.classList.contains('d2h-ins') || 
                              parentCell?.parentElement?.classList.contains('d2h-ins');
      
      // Determine side based on both index and classes
      let commentSide: 'FROM' | 'TO' | null = null;
      
      if (hasDeletedClass || isLeftSide) {
        commentSide = 'FROM';
      } else if (hasInsertedClass || isRightSide) {
        commentSide = 'TO';
      }
      
      // If we couldn't determine from classes, use index
      if (commentSide === null) {
        commentSide = isLeftSide ? 'FROM' : 'TO';
      }
      
      // Match the comment side with the diff side
      const shouldShowComment = comment.side === commentSide;
      
      if (!shouldShowComment) {
        return; // Skip this line number, it's on the wrong side
      }
      
      const nextRow = row.nextElementSibling;
      if (nextRow && nextRow.classList.contains('comment-row')) {
        commentInserted = true;
        return;
      }

      const commentRow = document.createElement('tr');
      commentRow.className = 'comment-row';

      const commentCell = document.createElement('td');
      commentCell.className = 'comment-cell';
      commentCell.setAttribute('colspan', '6');
      commentCell.style.padding = '0';
      commentCell.style.border = 'none';
      commentCell.style.backgroundColor = '#f0f7ff';

      const wrapperDiv = document.createElement('div');
      wrapperDiv.className = 'comment-wrapper';
      wrapperDiv.style.width = '100%';
      wrapperDiv.style.display = 'block';

      commentClone.style.display = 'block';
      commentClone.style.visibility = 'visible';
      commentClone.style.opacity = '1';

      wrapperDiv.appendChild(commentClone);
      commentCell.appendChild(wrapperDiv);
      commentRow.appendChild(commentCell);

      row.parentNode?.insertBefore(commentRow, row.nextSibling);

      commentInserted = true;
    }
  });
}
