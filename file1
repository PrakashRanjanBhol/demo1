// MODIFIED runDemo - Clear only on fresh start
public async runDemo(): Promise<void> {
  console.clear();
  console.log('ðŸš€ Starting streaming process...\n');
  
  // Reset lists
  this.executedItems = [];
  this.queuedItems = [];
  this.groupedExecutedItems = [];
  this.hasReceivedFirstChunk = false;
  this.isCompleted = false;
  this.showStreamingContainer = true;
  this.showApprovalCard = false;
  
  // Clear the streaming container ONLY when starting fresh
  this.clearStreamingContainer();
  
  // Setup callbacks before starting the stream
  this.setupCallbacks();
  
  this.isProcessing = true;
  
  try {
    await this.parserService.startStreaming();
  } catch (error) {
    if (error instanceof Error && error.name !== 'AbortError') {
      console.error('Failed to start streaming:', error);
    }
    this.isProcessing = false;
  }
}









// MODIFIED approveAndContinue - DON'T hide streaming container content
public async approveAndContinue(): Promise<void> {
  if (this.currentApprovalRequest && !this.isApprovingChanges) {
    console.log('âœ… APPROVED:', this.currentApprovalRequest.data);
    console.log('Saving code changes via API...\n');
    
    this.isApprovingChanges = true;
    this.cdr.detectChanges();
    
    try {
      const fileDetails = this.getFileDetails(this.currentApprovalRequest.data.content);
      
      if (fileDetails) {
        const payload = {
          tool: this.currentApprovalRequest.data.tool,
          file_path: fileDetails.file_path,
          file_name: fileDetails.file_name,
          original_code: fileDetails.original_code || '',
          modified_code: fileDetails.modified_code || '',
          reasoning: this.getReasoning(this.currentApprovalRequest.data.content),
          timestamp: new Date().toISOString()
        };
        
        await this.saveCodeChanges(payload);
        console.log('âœ… Code changes saved successfully');
      }
      
      // Hide approval card
      this.showApprovalCard = false;
      this.cdr.detectChanges();
      
      // Wait for approval card to hide, then append and show streaming container
      setTimeout(() => {
        // Append accepted file BEFORE showing streaming container
        this.appendAcceptedFile(this.currentApprovalRequest!.data, false);
        
        // Reset states
        this.isWaitingForApproval = false;
        this.currentApprovalRequest = null;
        
        // Show streaming container (this won't clear content, just shows it)
        this.showStreamingContainer = true;
        
        this.parserService.approveAndContinue();
        this.updateLists();
        this.scrollToBottom();
        this.cdr.detectChanges();
      }, 400);
      
    } catch (error) {
      console.error('âŒ Failed to save code changes:', error);
      alert('Failed to save code changes. Please try again.');
      this.isApprovingChanges = false;
      this.cdr.detectChanges();
      return;
    }
    
    setTimeout(() => {
      this.isApprovingChanges = false;
      this.cdr.detectChanges();
    }, 500);
  }
}

// MODIFIED rejectChanges - DON'T hide streaming container content
public rejectChanges(): void {
  if (this.currentApprovalRequest) {
    console.log('âŒ REJECTED:', this.currentApprovalRequest.data);
    console.log('Continuing with next operation...\n');
    
    this.currentApprovalRequest.data.rejected = true;
    this.executedItems.push(this.currentApprovalRequest.data);
    
    // Hide approval card
    this.showApprovalCard = false;
    this.cdr.detectChanges();
    
    // Wait for approval card to hide, then append and show streaming container
    setTimeout(() => {
      // Append rejected file BEFORE showing streaming container
      this.appendAcceptedFile(this.currentApprovalRequest!.data, true);
      
      // Reset states
      this.isWaitingForApproval = false;
      this.currentApprovalRequest = null;
      
      // Show streaming container (this won't clear content, just shows it)
      this.showStreamingContainer = true;
      
      this.parserService.approveAndContinue();
      this.updateLists();
      this.scrollToBottom();
      this.cdr.detectChanges();
    }, 400);
  }
}
