hasNoData = false;



/**
 * Map API response to result items
 */
private mapResponseToResultItems(data: any): void {
  this.resultItems = [];
  this.hasNoData = false;

  // Check if all data is empty
  const hasSummary = data.summary && data.summary.trim().length > 0;
  const hasKeywords = data.keywords && Array.isArray(data.keywords) && data.keywords.length > 0;
  const hasFaq = data.faq && data.faq.toString().trim().length > 0;

  // If all are empty, set empty state
  if (!hasSummary && !hasKeywords && !hasFaq) {
    this.hasNoData = true;
    return;
  }

  // Add Summary with markdown rendering
  if (hasSummary) {
    const htmlContent: any = marked(data.summary);
    this.resultItems.push({
      id: 'summary-1',
      title: 'Summary',
      icon: 'document',
      content: data.summary,
      type: 'summary',
      htmlContent: this.sanitizer.bypassSecurityTrustHtml(htmlContent)
    });
  }

  // Add Keywords
  if (hasKeywords) {
    this.resultItems.push({
      id: 'keywords-1',
      title: 'Key Topics',
      icon: 'tag',
      content: data.keywords.map((k: string) => `â€¢ ${k}`).join(' '),
      type: 'keywords',
      keywords: data.keywords
    });
  }

  // Add Assessment Questions (FAQ as MCQ)
  if (hasFaq) {
    try {
      const parsedFaq = typeof data.faq === 'string' ? eval(data.faq) : data.faq;
      
      // Store raw FAQ data for copying
      this.faqRawData = data.faq;
      
      if (Array.isArray(parsedFaq) && parsedFaq.length > 0) {
        this.resultItems.push({
          id: 'assessment-1',
          title: 'Assessment Questions',
          icon: 'question',
          content: `${parsedFaq.length} questions`,
          type: 'questions',
          assessmentQuestions: parsedFaq
        });
      }
    } catch (error) {
      console.error('Error parsing FAQ:', error);
    }
  }
}







/**
 * Load file analysis data from API
 */
loadFileAnalysis(fileId: string): void {
  this.expandedItems.clear();
  
  this.isLoading = true;
  this.errorMessage = '';
  this.resultItems = [];
  this.hasNoData = false;

  this.workspaceResultService.getFileAnalysis(fileId)
    .pipe(takeUntil(this.destroy$))
    .subscribe({
      next: (response) => {
        if (response.status === 'success' && response.data) {
          this.mapResponseToResultItems(response.data);
        }
        this.isLoading = false;
      },
      error: (error) => {
        console.error('Error loading file analysis:', error);
        this.errorMessage = 'Failed to load analysis data. Please try again.';
        this.isLoading = false;
      }
    });
}






<!-- Dynamic Result Content -->
<div class="result-content" *ngIf="selectedHistoryItem && !isLoading && !errorMessage">
    
    <!-- No Data State -->
    <div class="workspace-no-data-state" *ngIf="hasNoData">
        <div class="no-data-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
            </svg>
            <div class="no-data-overlay-icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
                </svg>
            </div>
        </div>
        <h3 class="no-data-title">No Analysis Available</h3>
        <p class="no-data-message">
            This file hasn't been analyzed yet or contains no data. The analysis may still be processing.
        </p>
        <div class="no-data-details">
            <div class="no-data-detail-item">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                </svg>
                <span>No Summary</span>
            </div>
            <div class="no-data-detail-item">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z M6 6h.008v.008H6V6z" />
                </svg>
                <span>No Key Topics</span>
            </div>
            <div class="no-data-detail-item">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z" />
                </svg>
                <span>No Assessment Questions</span>
            </div>
        </div>
    </div>

    <!-- Result Items (only show if data exists) -->
    <ng-container *ngIf="!hasNoData && resultItems.length > 0">
        <div class="result-item" *ngFor="let item of resultItems"
            [class.selected]="selectedResultItemId === item.id">
            <!-- ... existing result item code ... -->
        </div>
    </ng-container>
</div>








/* No Data State */
.workspace-no-data-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 40px;
    text-align: center;
    max-width: 500px;
    margin: 0 auto;
    animation: fadeInUp 0.5s ease-out;
}

.no-data-icon {
    width: 100px;
    height: 100px;
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(167, 139, 250, 0.1));
    border: 2px solid rgba(139, 92, 246, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 24px;
    position: relative;
    animation: float 3s ease-in-out infinite;
}

.no-data-icon > svg {
    width: 50px;
    height: 50px;
    stroke: var(--primary-color);
    opacity: 0.5;
}

.no-data-overlay-icon {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    background: var(--bg-color);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.no-data-overlay-icon svg {
    width: 28px;
    height: 28px;
    stroke: #ef4444;
    opacity: 0.8;
}

.no-data-title {
    font-size: 18px;
    font-weight: 700;
    color: var(--text-color);
    margin: 0 0 12px 0;
}

.no-data-message {
    font-size: 14px;
    color: var(--text-color);
    opacity: 0.7;
    margin: 0 0 32px 0;
    max-width: 380px;
    line-height: 1.6;
}

.no-data-details {
    display: flex;
    flex-direction: column;
    gap: 12px;
    width: 100%;
    max-width: 320px;
}

.no-data-detail-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.05), rgba(220, 38, 38, 0.03));
    border: 1px solid rgba(239, 68, 68, 0.15);
    border-radius: 8px;
    font-size: 13px;
    color: var(--text-color);
    opacity: 0.8;
    animation: slideInLeft 0.4s ease-out backwards;
}

.no-data-detail-item:nth-child(1) {
    animation-delay: 0.1s;
}

.no-data-detail-item:nth-child(2) {
    animation-delay: 0.2s;
}

.no-data-detail-item:nth-child(3) {
    animation-delay: 0.3s;
}

@keyframes slideInLeft {
    from {
        opacity: 0;
        transform: translateX(-20px);
    }
    to {
        opacity: 0.8;
        transform: translateX(0);
    }
}

.no-data-detail-item svg {
    width: 18px;
    height: 18px;
    stroke: #ef4444;
    flex-shrink: 0;
    opacity: 0.7;
}

.no-data-detail-item span {
    font-weight: 500;
}
