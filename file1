private processSingleTool(tool: ToolCommand): void {
  try {
    if (!tool.tool) {
      console.warn('Invalid tool object:', tool);
      return;
    }

    switch (tool.tool) {
      case 'READ':
        // Log READ immediately
        if (this.onLogCallback) {
          this.onLogCallback(tool);
        }
        break;

      case 'WRITE':
      case 'MODIFY':
        // Log WRITE/MODIFY immediately (before waiting)
        if (this.onLogCallback) {
          this.onLogCallback(tool);
        }
        
        // Only set waiting state if there are more items in queue OR streaming is still active
        const shouldWaitForApproval = this.processingQueue.length > 0 || this.isStreamingActive;
        
        if (shouldWaitForApproval) {
          this.currentWriteModifyTool = tool;
          this.waitingForApproval = true;
          this.isWaitingForUserApproval = true;
          this.triggerUpdate();
        } else {
          // This is the last item and streaming is done - don't wait
          this.waitingForApproval = false;
          this.isWaitingForUserApproval = false;
          this.currentWriteModifyTool = null;
        }
        break;

      default:
        console.warn('Unknown tool type:', tool.tool);
    }
  } catch (error) {
    console.error('Error processing tool:', tool, error);
  }
}
