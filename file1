interface FileInfo {
  id: number;
  name: string;
  path: string;
  size: string;
  repository: string;
  content: string;
  type: string;
  renderedContent?: SafeHtml;
  currentLoadedLines?: number;
  totalLines?: number;
}





private renderFileContent(file: FileInfo): void {
  if (!file) return;

  const fileType = file.type || 'plaintext';
  const lines = file.content.split('\n');
  
  // Set total lines only once
  if (!file.totalLines) {
    file.totalLines = lines.length;
  }
  
  // Initialize currentLoadedLines if not set
  if (!file.currentLoadedLines) {
    file.currentLoadedLines = Math.min(this.LINES_PER_LOAD, file.totalLines);
  }

  // Get only the chunk to display
  const contentToDisplay = lines.slice(0, file.currentLoadedLines).join('\n');

  let renderedContent: SafeHtml;
  
  if (fileType === 'markdown') {
    this.showViewToggle = true;
    if (this.currentView === 'preview') {
      renderedContent = this.sanitizer.bypassSecurityTrustHtml(
        this.renderMarkdownView(contentToDisplay)
      );
    } else {
      renderedContent = this.sanitizer.bypassSecurityTrustHtml(
        this.renderCodeView(contentToDisplay, 'markdown')
      );
    }
  } else {
    this.showViewToggle = false;
    this.currentView = 'code';
    renderedContent = this.sanitizer.bypassSecurityTrustHtml(
      this.renderCodeView(contentToDisplay, fileType)
    );
  }

  file.renderedContent = renderedContent;
}








// Method to switch to File view
selectFile(file: FileInfo): void {
  this.selectedFile = file;
  this.activeView = 'file';
  
  // Calculate total lines first time
  if (!file.totalLines) {
    file.totalLines = file.content.split('\n').length;
  }
  
  // Start with first chunk
  file.currentLoadedLines = Math.min(this.LINES_PER_LOAD, file.totalLines);
  
  this.renderFileContent(file);
}










// Load more lines (just re-render with more lines, no API call)
loadMoreLines(): void {
  if (!this.selectedFile || this.isLoading) return;
  
  this.isLoading = true;
  
  // Use setTimeout to avoid blocking UI thread
  setTimeout(() => {
    if (this.selectedFile && this.selectedFile.totalLines) {
      // Load next chunk
      const newLoadedLines = Math.min(
        (this.selectedFile.currentLoadedLines || 0) + this.LINES_PER_LOAD,
        this.selectedFile.totalLines
      );
      
      this.selectedFile.currentLoadedLines = newLoadedLines;
      this.renderFileContent(this.selectedFile);
    }
    this.isLoading = false;
  }, 50); // Small delay to prevent UI freeze
}














// Get lines info text
getLinesInfo(): string {
  if (!this.selectedFile || !this.selectedFile.totalLines) return '';
  const loaded = this.selectedFile.currentLoadedLines || 0;
  return `Showing ${loaded} of ${this.selectedFile.totalLines} lines`;
}

// Check if there are more lines to render
get hasMoreLines(): boolean {
  if (!this.selectedFile || !this.selectedFile.totalLines) return false;
  const loaded = this.selectedFile.currentLoadedLines || 0;
  return loaded < this.selectedFile.totalLines;
}







// File viewer methods
changeView(view: string): void {
  this.currentView = view;
  if (this.selectedFile) {
    // Re-render current loaded content in new view
    this.renderFileContent(this.selectedFile);
  }
}










