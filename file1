import { Component, Input, Output, EventEmitter, OnInit } from '@angular/core';

export interface Employee {
  id: number;
  email: string;
  selected: boolean;
}

@Component({
  selector: 'app-sidebar',
  templateUrl: './sidebar.component.html',
  styleUrls: ['./sidebar.component.css']
})
export class SidebarComponent implements OnInit {
  @Input() isSidebarOpen = false;
  @Output() onShare = new EventEmitter<string[]>();

  searchTerm = '';
  selectAll = false;
  employees: Employee[] = [];

  ngOnInit() {
    // Load employees directly here
    const employeeEmails = [
      "abc@test.com",
      "ijk@test.com",
      "lmn@test.com"
    ];

    this.employees = employeeEmails.map((email, index) => ({
      id: index + 1,
      email: email,
      selected: false
    }));
  }

  get filteredEmployees(): Employee[] {
    if (!this.searchTerm) {
      return this.employees;
    }
    return this.employees.filter(emp => 
      emp.email.toLowerCase().includes(this.searchTerm.toLowerCase())
    );
  }

  get selectedCount(): number {
    return this.filteredEmployees.filter(emp => emp.selected).length;
  }

  get totalVisible(): number {
    return this.filteredEmployees.length;
  }

  get isIndeterminate(): boolean {
    const selected = this.selectedCount;
    return selected > 0 && selected < this.totalVisible;
  }

  toggleSidebar(): void {
    this.isSidebarOpen = false;
  }

  onSearchChange(value: string): void {
    this.searchTerm = value;
    this.updateSelectAllState();
  }

  clearSearch(): void {
    this.searchTerm = '';
    this.updateSelectAllState();
  }

  toggleSelectAll(): void {
    const newState = !this.selectAll;
    this.filteredEmployees.forEach(emp => emp.selected = newState);
    this.selectAll = newState;
  }

  onEmployeeChange(): void {
    this.updateSelectAllState();
  }

  updateSelectAllState(): void {
    const selected = this.selectedCount;
    const total = this.totalVisible;
    
    if (selected === 0) {
      this.selectAll = false;
    } else if (selected === total) {
      this.selectAll = true;
    } else {
      this.selectAll = false;
    }
  }

  shareWorkflow(): void {
    const selectedEmails = this.employees
      .filter(emp => emp.selected)
      .map(emp => emp.email);
    
    if (selectedEmails.length > 0) {
      this.onShare.emit(selectedEmails);
    }
  }
}
